{"version":3,"sources":["file:///Users/zeruili/projects/cocos_project/TopRacing/assets/scripts/GameSceneLoader.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","resources","UITransform","TempData","ccclass","property","GameSceneLoader","start","loadLevelAndCar","levelId","selectedLevel","load","err","prefab","bgNode","setPosition","playGround","addChild","console","error","carId","selectedCar","carNode","spawnChildren","spawnPoint","children","length","randomIndex","Math","floor","random","spawnPos","getWorldPosition","localPos","canvas","getComponent","convertToNodeSpaceAR"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, resources, UITransform, Vec3 } from 'cc';\nimport { TempData } from './TempData';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameSceneLoader')\nexport class GameSceneLoader extends Component {\n    @property(Node)\n    playGround: Node = null!; // PlayGround节点\n\n    @property(Node)\n    canvas: Node = null!; // Canvas节点\n\n    @property(Node)\n    spawnPoint: Node = null!; // SpawnPoint节点\n\n    start() {\n        this.loadLevelAndCar();\n    }\n\n    loadLevelAndCar() {\n        // 1. 加载并实例化场景背景\n        const levelId = TempData.selectedLevel;\n        if (levelId) {\n            resources.load(`prefab/levels/${levelId}`, Prefab, (err, prefab) => {\n                if (!err && prefab) {\n                    const bgNode = instantiate(prefab);\n                    bgNode.setPosition(0, 0, 0);\n                    this.playGround.addChild(bgNode);\n                }\n                if (err) {\n                    console.error('加载关卡预制体失败:', err, levelId);\n                    return;\n                }\n                if (!prefab) {\n                    console.error('未找到关卡预制体:', levelId);\n                    return;\n                }\n            });\n        }\n\n        // 2. 加载并实例化车辆\n        const carId = TempData.selectedCar;\n        if (carId) {\n            resources.load(`prefab/cars/${carId}`, Prefab, (err, prefab) => {\n                if (!err && prefab) {\n                    const carNode = instantiate(prefab);\n                    // 随机选择一个SpawnPoint的子节点\n                    const spawnChildren = this.spawnPoint.children;\n                    if (spawnChildren.length > 0) {\n                        const randomIndex = Math.floor(Math.random() * spawnChildren.length);\n                        const spawnPos = spawnChildren[randomIndex].getWorldPosition();\n                        // 转换为Canvas的本地坐标\n                        const localPos = this.canvas.getComponent(UITransform).convertToNodeSpaceAR(spawnPos);\n                        carNode.setPosition(localPos);\n                    } else {\n                        carNode.setPosition(0, 0, 0);\n                    }\n                    this.canvas.addChild(carNode);\n                }\n                if (err) {\n                    console.error('加载车辆预制体失败:', err, levelId);\n                    return;\n                }\n                if (!prefab) {\n                    console.error('未找到车辆预制体:', levelId);\n                    return;\n                }\n            });\n        }\n    }\n} "]}