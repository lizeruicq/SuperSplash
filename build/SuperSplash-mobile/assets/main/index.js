System.register("chunks:///_virtual/AIController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(n){var e,r,t,i,a,s,o,u,l;return{setters:[function(n){e=n.applyDecoratedDescriptor,r=n.inheritsLoose,t=n.initializerDefineProperty,i=n.assertThisInitialized},function(n){a=n.cclegacy,s=n._decorator,o=n.Vec2,u=n.Component},function(n){l=n.GameManager}],execute:function(){var h,c,d,y,g,f;a._RF.push({},"f2409Jfl1NKgaxzoqghBXWi","AIController",void 0);var T=s.ccclass,b=s.property,A=function(n){return n[n.FreeDrive=0]="FreeDrive",n[n.BoundaryTurning=1]="BoundaryTurning",n}(A||{});n("AIController",T("AIController")((d=e((c=function(n){function e(){for(var e,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=n.call.apply(n,[this].concat(a))||this,t(e,"sceneMinX",d,i(e)),t(e,"sceneMaxX",y,i(e)),t(e,"sceneMinY",g,i(e)),t(e,"sceneMaxY",f,i(e)),e.aiStates=[],e.canvasWorldPos=new o,e.boundaryTurnTimers=[],e.boundaryTurnTargetAngles=[],e.boundaryTurnDirections=[],e.boundaryTurnStartAngles=[],e.lastAngleChanges=[],e.boundaryTurnCooldowns=[],e.aiPlayers=[],e}r(e,n);var a=e.prototype;return a.start=function(){},a.onScenePrefabLoaded=function(){console.log("场景预制体加载完成，通过GameManager获取AI车辆列表..."),this.aiPlayers=l.getInstance().getAIPlayers(),this.aiStates=this.aiPlayers.map((function(){return A.FreeDrive})),this.boundaryTurnTimers=this.aiPlayers.map((function(){return 0})),this.boundaryTurnTargetAngles=this.aiPlayers.map((function(){return 0})),this.boundaryTurnDirections=this.aiPlayers.map((function(){return 0})),this.boundaryTurnStartAngles=this.aiPlayers.map((function(){return 0})),this.lastAngleChanges=this.aiPlayers.map((function(){return 0})),this.boundaryTurnCooldowns=this.aiPlayers.map((function(){return 0})),console.log("AI车辆查找完成，找到 "+this.aiPlayers.length+" 个AI车辆")},a.refreshAIPlayers=function(){this.aiPlayers=l.getInstance().getAIPlayers(),this.aiStates=this.aiPlayers.map((function(){return A.FreeDrive})),this.boundaryTurnTimers=this.aiPlayers.map((function(){return 0})),this.boundaryTurnTargetAngles=this.aiPlayers.map((function(){return 0})),this.boundaryTurnDirections=this.aiPlayers.map((function(){return 0})),this.boundaryTurnStartAngles=this.aiPlayers.map((function(){return 0})),this.lastAngleChanges=this.aiPlayers.map((function(){return 0})),this.boundaryTurnCooldowns=this.aiPlayers.map((function(){return 0})),console.log("AI车辆列表已刷新，当前共有 "+this.aiPlayers.length+" 个AI车辆")},a.update=function(n){for(var e=0;e<this.aiPlayers.length;e++){var r=this.aiPlayers[e];r&&(this.boundaryTurnTimers[e]+=n,this.boundaryTurnCooldowns[e]+=n,this.aiStates[e]!==A.BoundaryTurning?0!=this.aiPlayers.length&&this.freeDrive(r,e):this.handleBoundaryTurning(r,e,n))}},a.freeDrive=function(n,e){Math.random()<.005&&n.setDirection(Math.random()<.5?-1:1),Math.random()<.01&&n.setAccel(Math.random()<.8?1:0);var r=n.node.worldPosition,t=r.x-this.canvasWorldPos.x,i=r.y-this.canvasWorldPos.y,a=400,s=t<this.sceneMinX+a,o=t>this.sceneMaxX-a,u=i<this.sceneMinY+a,l=i>this.sceneMaxY-a;if(s||o||u||l){var h=this.boundaryTurnCooldowns[e]<0?Math.abs(this.boundaryTurnCooldowns[e]):3;if(this.boundaryTurnCooldowns[e]>=h)this.startBoundaryTurning(n,e,s,o,u,l);else{this.boundaryTurnCooldowns[e]<0&&Math.abs(this.boundaryTurnCooldowns[e]);n.setAccel(1)}}else n.setAccel(1)},a.startBoundaryTurning=function(n,e,r,t,i,a){this.aiStates[e]=A.BoundaryTurning,this.boundaryTurnTimers[e]=0,this.boundaryTurnStartAngles[e]=n.getCurrentAngle(),this.boundaryTurnCooldowns[e]=0;var s,o=0,u=n.getCurrentAngle();r&&i||r&&a||t&&i||t&&a?(o=(u+180)%360,this.boundaryTurnCooldowns[e]=-5):r?o=u>180?90*Math.random():270+90*Math.random():t?o=u<180?180+180*Math.random():180*Math.random():i?o=u>90&&u<270?90*Math.random():270+90*Math.random():a&&(o=u<90||u>270?90+180*Math.random():90*Math.random()+270),(o%=360)<0&&(o+=360);for(var l=o-u;l>180;)l-=360;for(;l<-180;)l+=360;s=l>0?1:-1,this.boundaryTurnTargetAngles[e]=o,this.boundaryTurnDirections[e]=s,n.setTargetAngle(o),n.setDirection(s),n.setAccel(1)},a.handleBoundaryTurning=function(n,e,r){for(var t=n.getCurrentAngle(),i=this.boundaryTurnTargetAngles[e],a=t-this.boundaryTurnStartAngles[e];a>180;)a-=360;for(;a<-180;)a+=360;for(var s=i-t;s>180;)s-=360;for(;s<-180;)s+=360;if(Math.abs(s-this.lastAngleChanges[e])<5&&Math.sign(s)!==Math.sign(this.lastAngleChanges[e]))return n.setDirection(0),n.setAccel(1),this.aiStates[e]=A.FreeDrive,void(this.boundaryTurnCooldowns[e]=0);if(this.lastAngleChanges[e]=s,Math.abs(s)<30)return n.setDirection(0),n.setAccel(1),this.aiStates[e]=A.FreeDrive,void(this.boundaryTurnCooldowns[e]=0);if(Math.abs(a)>=30){var o=n.node.worldPosition,u=o.x-this.canvasWorldPos.x,l=o.y-this.canvasWorldPos.y;if(u>this.sceneMinX+400&&u<this.sceneMaxX-400&&l>this.sceneMinY+400&&l<this.sceneMaxY-400)return n.setDirection(0),n.setAccel(1),this.aiStates[e]=A.FreeDrive,void(this.boundaryTurnCooldowns[e]=0)}if(this.boundaryTurnTimers[e]>3)return n.setDirection(0),n.setAccel(1),void(this.aiStates[e]=A.FreeDrive);var h=Math.abs(s);if(h<30)n.setDirection(0),n.setAccel(1);else{if(h>90)n.setDirection(this.boundaryTurnDirections[e]);else if(h>60)n.setDirection(this.boundaryTurnDirections[e]);else if(h>30){this.boundaryTurnTimers[e]%.12<.08?n.setDirection(this.boundaryTurnDirections[e]):n.setDirection(0)}else n.setDirection(0);n.setAccel(1)}},a.setAIHealth=function(n,e){if(n>=0&&n<this.aiPlayers.length){var r=this.aiPlayers[n];r&&r.node&&r.node.isValid&&r.setHealth(e)}},a.damageAI=function(n,e){if(n>=0&&n<this.aiPlayers.length){var r=this.aiPlayers[n];r&&r.node&&r.node.isValid&&r.takeDamage(e)}},a.healAI=function(n,e){if(n>=0&&n<this.aiPlayers.length){var r=this.aiPlayers[n];r&&r.node&&r.node.isValid&&r.heal(e)}},a.getAIHealth=function(n){if(n>=0&&n<this.aiPlayers.length){var e=this.aiPlayers[n];if(e&&e.node&&e.node.isValid)return e.getHealth()}return 0},a.getAIMaxHealth=function(n){if(n>=0&&n<this.aiPlayers.length){var e=this.aiPlayers[n];if(e&&e.node&&e.node.isValid)return e.getMaxHealth()}return 0},a.isAIDead=function(n){if(n>=0&&n<this.aiPlayers.length){var e=this.aiPlayers[n];if(e&&e.node&&e.node.isValid)return e.isDead()}return!0},a.isAIBoundaryTurning=function(n){var e=this.aiPlayers.indexOf(n);return-1!==e&&this.aiStates[e]===A.BoundaryTurning},e}(u)).prototype,"sceneMinX",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1048.5}}),y=e(c.prototype,"sceneMaxX",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2328.5}}),g=e(c.prototype,"sceneMinY",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-692.5}}),f=e(c.prototype,"sceneMaxY",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1412.5}}),h=c))||h);a._RF.pop()}}}));

System.register("chunks:///_virtual/AIPlayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./player.ts","./GameManager.ts","./AIController.ts","./SoundManager.ts"],(function(t){var e,i,n,o,r,a,l,s,h,c,d,u,g,y,p,f,_,m,b,v,B,A,P,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.ProgressBar,s=t.SpriteFrame,h=t.Prefab,c=t.Vec2,d=t.RigidBody2D,u=t.ERigidBody2DType,g=t.BoxCollider2D,y=t.Contact2DType,p=t.Layers,f=t.find,_=t.Sprite,m=t.tween,b=t.Vec3,v=t.Component},function(t){B=t.player},function(t){A=t.GameManager},function(t){P=t.AIController},function(t){D=t.SoundManager}],execute:function(){var w,C,I,H,S,V,x,M,z,k,T,R,E,F,N,L,G,O;r._RF.push({},"91c082Rgh1HBbV2vKQl2J1W","AIPlayer",void 0);var W=a.ccclass,j=a.property;t("AIPlayer",(w=W("AIPlayer"),C=j(l),I=j(s),H=j(h),w((x=e((V=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"maxSpeed",x,o(e)),n(e,"acceleration",M,o(e)),n(e,"brakeDeceleration",z,o(e)),n(e,"turnSpeed",k,o(e)),n(e,"friction",T,o(e)),n(e,"initAngle",R,o(e)),n(e,"maxHealth",E,o(e)),n(e,"healthBar",F,o(e)),n(e,"destroyedSprite",N,o(e)),n(e,"removeDelay",L,o(e)),n(e,"paintPrefab",G,o(e)),n(e,"paintSprayInterval",O,o(e)),e._rigidBody=null,e._direction=0,e._accel=0,e._angle=0,e._targetAngle=0,e._lastValidPosition=new c,e._currentHealth=100,e._isDestroyed=!1,e._paintTimer=0,e._vehicleId="",e._blockCollisionCooldown=0,e._blockCollisionCooldownDuration=3,e}i(e,t);var r=e.prototype;return r.onLoad=function(){this._rigidBody=null,this._direction=0,this._accel=0,this._angle=0,this._targetAngle=0,this._lastValidPosition=new c,this._isDestroyed=!1,this._paintTimer=0,this._vehicleId="ai_"+this.node.name+"_"+Date.now(),this._blockCollisionCooldown=0},r.start=function(){if(this._rigidBody=this.getComponent(d),this._rigidBody&&this.node&&this.node.isValid){this._rigidBody.type=u.Dynamic,this._rigidBody.allowSleep=!1,this._rigidBody.gravityScale=0,this._rigidBody.linearDamping=.3,this._rigidBody.angularDamping=.9,this._rigidBody.fixedRotation=!0,this._lastValidPosition=new c(this.node.worldPosition.x,this.node.worldPosition.y),this._angle=this.initAngle,this._targetAngle=this.initAngle,this.node.setRotationFromEuler(0,0,this.initAngle),this.initHealthBar();var t=this.getComponent(g);t?(console.log("AIPlayer BoxCollider2D component found"),t.on(y.BEGIN_CONTACT,this.onCollisionEnter,this)):console.error("AIPlayer BoxCollider2D component not found")}else console.error("AIPlayer requires RigidBody2D component and valid node")},r.initHealthBar=function(){this._currentHealth=this.maxHealth},r.updateHealthBar=function(){this.healthBar&&(this.healthBar.progress=this._currentHealth/this.maxHealth,console.log("AIPlayer updating health bar:",this._currentHealth/this.maxHealth))},r.update=function(t){if(this._rigidBody&&this.node&&this.node.isValid&&(this._blockCollisionCooldown>0&&(this._blockCollisionCooldown-=t),!this._isDestroyed)){var e=this._rigidBody.linearVelocity,i=e.length(),n=new c(this.node.worldPosition.x,this.node.worldPosition.y);if(0!==this._direction){var o=this.turnSpeed*t*this._direction;this._targetAngle-=o}var r=this._targetAngle-this._angle;if(Math.abs(r)>.1?this._angle+=.1*r:this._angle=this._targetAngle,this.node.setRotationFromEuler(0,0,this._angle),1===this._accel){var a=(this._angle+90)*Math.PI/180,l=new c(Math.cos(a)*this.acceleration,Math.sin(a)*this.acceleration);this._rigidBody.applyForce(l,n,!0)}else if(-1===this._accel){var s=(this._angle+90)*Math.PI/180,h=new c(Math.cos(s),Math.sin(s));if(e.dot(h)>0){var d=h.clone().multiplyScalar(-this.brakeDeceleration);this._rigidBody.applyForce(d,n,!0)}else{var u=h.clone().multiplyScalar(.5*-this.acceleration);this._rigidBody.applyForce(u,n,!0)}}else if(i>1){var g=e.clone().multiplyScalar(2*-this.friction);this._rigidBody.applyForce(g,n,!0)}if(i>this.maxSpeed){var y=e.clone().normalize();this._rigidBody.linearVelocity=y.multiplyScalar(this.maxSpeed)}if(i<.1)c.distance(n,this._lastValidPosition)>50&&(this.node.setWorldPosition(this._lastValidPosition.x,this._lastValidPosition.y,this.node.worldPosition.z),this._rigidBody.linearVelocity=new c(0,0));else this._lastValidPosition=n.clone();Math.abs(this._angle)>360&&(this._angle=this._angle%360,this._targetAngle=this._targetAngle%360),this.updatePaintSpray(t)}},r.setAccel=function(t){this._accel=t},r.setDirection=function(t){this._direction=t},r.setTargetAngle=function(t){this._targetAngle=t},r.getCurrentAngle=function(){return this._angle},r.init=function(t){this.initAngle=t,this._angle=t,this._targetAngle=t,this.node.setRotationFromEuler(0,0,t)},r.setHealth=function(t){this._currentHealth=Math.max(0,Math.min(t,this.maxHealth)),this.updateHealthBar()},r.takeDamage=function(t){this._isDestroyed||(console.log("AIPlayer taking damage:",t),this.setHealth(this._currentHealth-t),this.updateHealthBar(),this._currentHealth<=0&&this.destroyVehicle())},r.heal=function(t){this.setHealth(this._currentHealth+t),this.updateHealthBar()},r.getHealth=function(){return this._currentHealth},r.getMaxHealth=function(){return this.maxHealth},r.isDead=function(){return this._currentHealth<=0},r.onCollisionEnter=function(t,e){if(e.node.layer!==p.nameToLayer("Block")){var i=e.node.getComponent(B);if(i){console.log("AIPlayer 被玩家车辆撞击");var n=i.getRigidBody();if(n&&!this.isDestroyed){var o=new c(n.linearVelocity.x,n.linearVelocity.y);o.normalize(),o.multiplyScalar(20),this._rigidBody.linearVelocity=o}}}else{if(this._blockCollisionCooldown>0)return;var r=f("AIController");if(r){var a=r.getComponent(P);if(a){if(a.isAIBoundaryTurning(this))return;this._blockCollisionCooldown=this._blockCollisionCooldownDuration;var l=Math.random()<.5?-1:1,s=130+50*Math.random(),h=this.getCurrentAngle(),d=l>0?h+s:h-s;this.setTargetAngle(d),this.setDirection(l),this.setAccel(1)}}}},r.destroyVehicle=function(){if(!this._isDestroyed){if(this._isDestroyed=!0,console.log("AI车辆被摧毁！"),D.instance.playSoundEffect("carDestruction"),this.destroyedSprite){var t=this.getComponent(_);t&&(t.spriteFrame=this.destroyedSprite)}this.healthBar&&this.healthBar.node&&(this.healthBar.node.active=!1),this.startDestroyAnimation(),this.updateEnemyCount(),this.scheduleRemoveNode()}},r.updateEnemyCount=function(){var t=A.getInstance();if(t){var e=t.getAIPlayers().filter((function(t){return!t.isDestroyed()})).length;t.refreshEnemyCount(e)}},r.scheduleRemoveNode=function(){var t=this;this.node&&this.node.isValid&&this.scheduleOnce((function(){t.removeVehicleNode()}),this.removeDelay)},r.removeVehicleNode=function(){if(this.node&&this.node.isValid){console.log("移除AI车辆节点");var t=A.getInstance();if(t){var e=t.getAIPlayers(),i=e.indexOf(this);-1!==i&&e.splice(i,1),t.refreshEnemyCount(e.length)}this.node.removeFromParent()}},r.startDestroyAnimation=function(){this.node&&m(this.node).to(2,{scale:new b(1.1,1.1,1)}).start()},r.isDestroyed=function(){return this._isDestroyed},r.updatePaintSpray=function(t){!this._isDestroyed&&this.paintPrefab&&(this._paintTimer+=t,this._paintTimer>=this.paintSprayInterval&&(this.sprayPaint(),this._paintTimer=0))},r.sprayPaint=function(){var t=A.getInstance();if(t){var e=this.node.getWorldPosition();t.sprayPaint(this.paintPrefab,e,this._vehicleId)}else console.warn("GameManager未找到，无法喷洒颜料")},e}(v)).prototype,"maxSpeed",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),M=e(V.prototype,"acceleration",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),z=e(V.prototype,"brakeDeceleration",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),k=e(V.prototype,"turnSpeed",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),T=e(V.prototype,"friction",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),R=e(V.prototype,"initAngle",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E=e(V.prototype,"maxHealth",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),F=e(V.prototype,"healthBar",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(V.prototype,"destroyedSprite",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(V.prototype,"removeDelay",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),G=e(V.prototype,"paintPrefab",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(V.prototype,"paintSprayInterval",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),S=V))||S));r._RF.pop()}}}));

System.register("chunks:///_virtual/Bullet.ts",["./rollupPluginModLoBabelHelpers.js","cc","./player.ts","./AIPlayer.ts","./SoundManager.ts","./GameManager.ts"],(function(e){var t,i,n,o,l,s,a,r,d,c,u,h,p,f,y,g,m,E,R,v,x,b,_;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){l=e.cclegacy,s=e._decorator,a=e.Enum,r=e.Prefab,d=e.RigidBody2D,c=e.Collider2D,u=e.Contact2DType,h=e.instantiate,p=e.Vec3,f=e.Animation,y=e.tween,g=e.Vec2,m=e.director,E=e.Director,R=e.Component},function(e){v=e.player},function(e){x=e.AIPlayer},function(e){b=e.SoundManager},function(e){_=e.GameManager}],execute:function(){var B,C,T,w,I,P,O,M,V,D,A,H,k;l._RF.push({},"91ffczWtpJKh6L+Ua3qo7Ip","Bullet",void 0);var N=s.ccclass,S=s.property,L=e("WeaponType",function(e){return e[e.NORMAL=0]="NORMAL",e[e.ROCKET=2]="ROCKET",e}({})),z=e("BulletType",function(e){return e[e.NORMAL=0]="NORMAL",e[e.ROCKET=2]="ROCKET",e}({}));a(L),a(z);e("Bullet",(B=N("Bullet"),C=S({type:z,tooltip:"子弹类型"}),T=S({tooltip:"子弹存活时间（秒）"}),w=S({type:r,tooltip:"爆炸效果预制体（火箭弹专用）"}),I=S({tooltip:"爆炸范围（火箭弹专用）"}),B((M=t((O=function(e){function t(){for(var t,i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];return t=e.call.apply(e,[this].concat(l))||this,n(t,"speed",M,o(t)),n(t,"damage",V,o(t)),n(t,"bulletType",D,o(t)),n(t,"lifeTime",A,o(t)),n(t,"explosionPrefab",H,o(t)),n(t,"explosionRadius",k,o(t)),t._shooterId="",t._rigidBody=null,t._direction=new g(0,1),t._velocity=new g(0,0),t._timer=0,t._isExploding=!1,t._pendingDestroy=!1,t}i(t,e);var l=t.prototype;return l.onLoad=function(){this._rigidBody=this.getComponent(d),this._rigidBody||console.error("Bullet: RigidBody2D组件未找到");var e=this.getComponent(c);e&&e.on(u.BEGIN_CONTACT,this.onBeginContact,this)},l.start=function(){},l.update=function(e){if(!this._isExploding){if(this._timer+=e,this._timer>=this.lifeTime)return this.bulletType===z.ROCKET?void this.handleTimeoutExplosion():void this.destroyBullet();this._rigidBody&&(this._velocity.set(this._direction.x*this.speed,this._direction.y*this.speed),this._rigidBody.linearVelocity=this._velocity)}},l.init=function(e,t){this._direction=e.normalize(),this._shooterId=t;var i=180*Math.atan2(e.y,e.x)/Math.PI;this.node.setRotationFromEuler(0,0,i-90)},l.onBeginContact=function(e,t,i){var n=t.node;if(this.getVehicleId(n)!==this._shooterId){var o=n.getComponent(v),l=n.getComponent(x);o||l?this.handleVehicleHit(n,o,l):this.handleObstacleHit()}},l.handleVehicleHit=function(e,t,i){switch(console.log("子弹撞击类型",this.bulletType),this.bulletType){case z.NORMAL:return this.handleNormalBulletHit(t,i),void this.handleBulletExplosion();case z.ROCKET:return void this.handleRocketHit(e)}},l.handleNormalBulletHit=function(e,t){e?e.takeDamage(this.damage):t&&t.takeDamage(this.damage)},l.handleBulletExplosion=function(){this._isExploding=!0,this.stopMovement(),this.createBulletExplosion(),b.instance.playSoundEffect("bulletHit")},l.handleRocketHit=function(e){this._isExploding=!0,this.stopMovement(),this.createRocketExplosion(),this.dealExplosionDamage(),this.clearPaintInRange(),b.instance.playSoundEffect("explosion")},l.handleTimeoutExplosion=function(){this._isExploding=!0,this.stopMovement(),this.createRocketExplosion(),this.clearPaintInRange(),this.dealExplosionDamage(),b.instance.playSoundEffect("explosion")},l.createBulletExplosion=function(){var e=this;if(this.explosionPrefab){var t=h(this.explosionPrefab);this.node.addChild(t),t.setPosition(p.ZERO);var i=t.getComponent(f);i?(i.play("explosion"),this.scheduleOnce((function(){t&&t.isValid&&t.destroy(),e.destroyBullet()}),.3)):y(t).to(.3,{scale:new p(1.5,1.5,1)}).delay(.3).call((function(){t&&t.isValid&&t.destroy(),e.destroyBullet()})).start()}else this.destroyBullet()},l.createRocketExplosion=function(){var e=this;if(this.explosionPrefab){var t=h(this.explosionPrefab);this.node.addChild(t),t.setPosition(p.ZERO);var i=t.getComponent(f);i?(i.play("explosion"),this.scheduleOnce((function(){t&&t.isValid&&t.destroy(),e.destroyBullet()}),.5)):y(t).to(.5,{scale:new p(2,2,1)}).delay(.5).call((function(){t&&t.isValid&&t.destroy(),e.destroyBullet()})).start()}else this.destroyBullet()},l.dealExplosionDamage=function(){var e=this;this.getAllVehiclesInRange().forEach((function(t){var i=g.distance(new g(e.node.worldPosition.x,e.node.worldPosition.y),new g(t.node.worldPosition.x,t.node.worldPosition.y));if(i<=e.explosionRadius){var n=1-i/e.explosionRadius,o=e.damage*n;t.takeDamage(o)}}))},l.clearPaintInRange=function(){var e=_.getInstance();if(e){var t=e.getPaintManager();if(t){var i=new g(this.node.worldPosition.x,this.node.worldPosition.y),n=t.clearPaintInRange(i,this.explosionRadius);console.log("火箭弹爆炸清除了 "+n+" 个颜料")}else console.warn("Bullet: 无法获取PaintManager实例")}else console.warn("Bullet: 无法获取GameManager单例")},l.getAllVehiclesInRange=function(){var e,t,i=this,n=[];return((null==(e=this.node.scene)?void 0:e.getComponentsInChildren(v))||[]).forEach((function(e){i.getVehicleId(e.node)!==i._shooterId&&n.push(e)})),((null==(t=this.node.scene)?void 0:t.getComponentsInChildren(x))||[]).forEach((function(e){i.getVehicleId(e.node)!==i._shooterId&&n.push(e)})),n},l.handleObstacleHit=function(){this.bulletType!==z.ROCKET?(this.playHitSound(),this.destroyBullet()):this.handleRocketHit(null)},l.stopMovement=function(){this._rigidBody&&(this._rigidBody.linearVelocity=g.ZERO)},l.getVehicleId=function(e){var t=e.getComponent(v),i=e.getComponent(x);return t?"player":i?i.getVehicleId?i.getVehicleId():"ai_unknown":"unknown"},l.playHitSound=function(){switch(this.bulletType){case z.NORMAL:b.instance.playSoundEffect("bulletHit");break;case z.ROCKET:b.instance.playSoundEffect("explosion")}},l.destroyBullet=function(){var e=this;this.node&&this.node.isValid&&(this._pendingDestroy||(this._pendingDestroy=!0,m.once(E.EVENT_AFTER_PHYSICS,(function(){e.node&&e.node.isValid&&e.node.destroy()}))))},t}(R)).prototype,"speed",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),V=t(O.prototype,"damage",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),D=t(O.prototype,"bulletType",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return z.NORMAL}}),A=t(O.prototype,"lifeTime",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),H=t(O.prototype,"explosionPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(O.prototype,"explosionRadius",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),P=O))||P));l._RF.pop()}}}));

System.register("chunks:///_virtual/camera_follow.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,o,n,a,s,r,h,p,l,d,c;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.Node,h=t.Vec3,p=t.UITransform,l=t.Camera,d=t.view,c=t.Component}],execute:function(){var m,u,_,g,f,y;a._RF.push({},"daf21OCa1hMm660rOlgyMop","camera_follow",void 0);var w=s.ccclass,P=s.property;t("CameraFollow",(m=w("CameraFollow"),u=P(r),m((f=i((g=function(t){function i(){for(var i,e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return i=t.call.apply(t,[this].concat(a))||this,o(i,"target",f,n(i)),o(i,"smooth",y,n(i)),i._tempPos=new h,i._mapWidth=0,i._mapHeight=0,i}e(i,t);var a=i.prototype;return a.onLoad=function(){this._tempPos=new h,this._mapWidth=0,this._mapHeight=0},a.onDestroy=function(){this.target=null,this._tempPos=null},a._detectMapSize=function(){if(this.node&&this.node.parent){var t=this.node.parent.children.find((function(t){return"PlayGround"===t.name}));if(t){var i=t.getComponentInChildren(p);i&&(this._mapWidth=i.contentSize.width*t.scale.x,this._mapHeight=i.contentSize.height*t.scale.y)}0!==this._mapWidth&&0!==this._mapHeight||(console.log("没有检测到地图尺寸"),this._mapWidth=2160,this._mapHeight=1440)}},a.update=function(t){this.node&&this.node.isValid&&this._updateCameraPosition(t,!1)},a._clampToMapBounds=function(t,i,e,o){if(!this.node||!this.node.parent)return[t,i];var n=this.node.parent.worldPosition.x,a=this.node.parent.worldPosition.y,s=n-this._mapWidth/2+e/2,r=n+this._mapWidth/2-e/2,h=a-this._mapHeight/2+o/2,p=a+this._mapHeight/2-o/2;return[s>r?n:t<s?s:t>r?r:t,h>p?a:i<h?h:i>p?p:i]},a._updateCameraPosition=function(t,i){if(this.target&&this.node&&this.node.isValid){this.target.getWorldPosition(this._tempPos);var e=this.getComponent(l);if(e){var o=d.getVisibleSize().width/d.getVisibleSize().height,n=e.orthoHeight,a=n*o,s=n,r=this._clampToMapBounds(this._tempPos.x,this._tempPos.y,a,s),h=r[0],p=r[1],c=this.node.worldPosition;i?this.node.setWorldPosition(h,p,c.z):this.node.setWorldPosition(c.x+(h-c.x)*(1-Math.pow(1-this.smooth,60*t)),c.y+(p-c.y)*(1-Math.pow(1-this.smooth,60*t)),c.z)}}},a.init=function(t,i){if(this.target=i,t){var e=t.getComponent(p);e&&(this._mapWidth=e.contentSize.width*t.scale.x,this._mapHeight=e.contentSize.height*t.scale.y)}},i}(c)).prototype,"target",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=i(g.prototype,"smooth",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),_=g))||_));a._RF.pop()}}}));

System.register("chunks:///_virtual/CarProperties.ts",["cc"],(function(r){var e,t;return{setters:[function(r){e=r.cclegacy,t=r._decorator}],execute:function(){var i,s;e._RF.push({},"796e3d2xZlPdZWRNarqrn+2","CarProperties",void 0);var a=t.ccclass;r("CarProperties",a("CarProperties")(((s=function(){function r(){}return r.getCarProperty=function(r){return this.carPropertiesConfig[r]||null},r}()).carPropertiesConfig={"car-1":{speed:60,steering:70,durability:80},"car-2":{speed:75,steering:65,durability:70},"car-3":{speed:85,steering:60,durability:65},"car-4":{speed:90,steering:55,durability:60},"car-5":{speed:95,steering:50,durability:55}},i=s))||i);e._RF.pop()}}}));

System.register("chunks:///_virtual/CarPropertyDisplay.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CarProperties.ts"],(function(r){var e,t,i,o,s,a,n,l,p,u;return{setters:[function(r){e=r.applyDecoratedDescriptor,t=r.inheritsLoose,i=r.initializerDefineProperty,o=r.assertThisInitialized},function(r){s=r.cclegacy,a=r._decorator,n=r.ProgressBar,l=r.tween,p=r.Component},function(r){u=r.CarProperties}],execute:function(){var g,d,h,c,y,P,B,f,b,m,C,v,D;s._RF.push({},"add91PL8SRFs5KSXc8GbptH","CarPropertyDisplay",void 0);var w=a.ccclass,z=a.property;r("CarPropertyDisplay",(g=w("CarPropertyDisplay"),d=z({type:n,tooltip:"速度进度条"}),h=z({type:n,tooltip:"转向进度条"}),c=z({type:n,tooltip:"坚硬度进度条"}),y=z({tooltip:"是否启用动画效果"}),P=z({tooltip:"动画持续时间（秒）"}),g((b=e((f=function(r){function e(){for(var e,t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e=r.call.apply(r,[this].concat(s))||this,i(e,"speedProgressBar",b,o(e)),i(e,"steeringProgressBar",m,o(e)),i(e,"durabilityProgressBar",C,o(e)),i(e,"enableAnimation",v,o(e)),i(e,"animationDuration",D,o(e)),e}t(e,r);var s=e.prototype;return s.onLoad=function(){this.autoFindProgressBars(),this.hideAllProperties()},s.autoFindProgressBars=function(){if(!this.speedProgressBar){var r=this.node.getChildByName("speed")||this.node.getChildByName("Speed");r&&(this.speedProgressBar=r.getComponent(n))}if(!this.steeringProgressBar){var e=this.node.getChildByName("turn")||this.node.getChildByName("turn");e&&(this.steeringProgressBar=e.getComponent(n))}if(!this.durabilityProgressBar){var t=this.node.getChildByName("tough")||this.node.getChildByName("tough");t&&(this.durabilityProgressBar=t.getComponent(n))}},s.showCarProperties=function(r){var e=u.getCarProperty(r);if(!e)return console.warn("未找到车辆 "+r+" 的属性配置"),void this.hideAllProperties();this.updatePropertyDisplay(e),this.node.active=!0},s.hideAllProperties=function(){this.node.active=!1},s.updatePropertyDisplay=function(r){this.speedProgressBar&&this.updateProgressBar(this.speedProgressBar,r.speed),this.steeringProgressBar&&this.updateProgressBar(this.steeringProgressBar,r.steering),this.durabilityProgressBar&&this.updateProgressBar(this.durabilityProgressBar,r.durability)},s.updateProgressBar=function(r,e){var t=e/100;this.enableAnimation?l(r).to(this.animationDuration,{progress:t}).start():r.progress=t},e}(p)).prototype,"speedProgressBar",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(f.prototype,"steeringProgressBar",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(f.prototype,"durabilityProgressBar",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(f.prototype,"enableAnimation",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),D=e(f.prototype,"animationDuration",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),B=f))||B));s._RF.pop()}}}));

System.register("chunks:///_virtual/GameHUD.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(e){var t,n,o,a,i,r,l,s,u,c,g,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){i=e.cclegacy,r=e._decorator,l=e.Label,s=e.Button,u=e.ProgressBar,c=e.Node,g=e.Component},function(e){h=e.GameManager}],execute:function(){var p,m,d,f,y,b,D,B,w,R,U,H,G,L,v,M,T,C,A,P,z,E,I,_,N,O,S,k,x,F;i._RF.push({},"8d994pxBTRN65Jo2JjZ4MAH","GameHUD",void 0);var j=r.ccclass,J=r.property;e("GameHUD",(p=j("GameHUD"),m=J(l),d=J(l),f=J({type:l,tooltip:"AI车辆1的颜料占比显示标签"}),y=J({type:l,tooltip:"AI车辆2的颜料占比显示标签"}),b=J({type:l,tooltip:"AI车辆3的颜料占比显示标签"}),D=J({type:l,tooltip:"AI车辆4的颜料占比显示标签"}),B=J({type:s,tooltip:"射击按钮"}),w=J({type:l,tooltip:"弹药数量显示标签"}),R=J({type:u,tooltip:"弹药补充进度条"}),U=J({type:s,tooltip:"向上移动按钮"}),H=J({type:s,tooltip:"向下移动按钮"}),G=J({type:s,tooltip:"向左移动按钮"}),L=J({type:s,tooltip:"向右移动按钮"}),p((T=t((M=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return t=e.call.apply(e,[this].concat(i))||this,o(t,"countdownLabel",T,a(t)),o(t,"playerRatioLabel",C,a(t)),o(t,"ai1RatioLabel",A,a(t)),o(t,"ai2RatioLabel",P,a(t)),o(t,"ai3RatioLabel",z,a(t)),o(t,"ai4RatioLabel",E,a(t)),o(t,"shootButton",I,a(t)),o(t,"ammoLabel",_,a(t)),o(t,"reloadProgressBar",N,a(t)),o(t,"upButton",O,a(t)),o(t,"downButton",S,a(t)),o(t,"leftButton",k,a(t)),o(t,"rightButton",x,a(t)),o(t,"updateInterval",F,a(t)),t.updateTimer=0,t.gameManager=null,t}n(t,e);var i=t.prototype;return i.onLoad=function(){this.updateTimer=0},i.start=function(){this.gameManager=h.getInstance(),this.gameManager?(this.initializeAIRatioDisplay(),this.initializeShootButton(),this.initializeTouchControlButtons()):console.error("GameHUD: GameManager未找到")},i.update=function(e){this.gameManager&&(this.updateTimer+=e,this.updateTimer>=this.updateInterval&&(this.updateCountdownDisplay(),this.updatePaintRatioDisplay(),this.updateAmmoDisplay(),this.updateTimer=0))},i.updateCountdownDisplay=function(){if(this.countdownLabel){var e=this.gameManager.getFormattedRemainingTime();this.countdownLabel.string=e,this.gameManager.getRemainingTime()<=30&&(this.countdownLabel.color=this.countdownLabel.color.lerp(new this.countdownLabel.color.constructor(255,0,0,255),.5))}},i.updatePaintRatioDisplay=function(){var e=this.gameManager.getAllVehiclePaintRatios(),t=e.player||0;this.updatePlayerRatioDisplay(t),this.updateAIRatiosDisplay(e)},i.updatePlayerRatioDisplay=function(e){var t=Math.round(100*e);this.playerRatioLabel&&(this.playerRatioLabel.string="player: "+t+"%")},i.updateAIRatiosDisplay=function(e){var t=this,n=this.gameManager.getSortedVehiclePaintRatios().filter((function(e){return"player"!==e.vehicleId})),o=[this.ai1RatioLabel,this.ai2RatioLabel,this.ai3RatioLabel,this.ai4RatioLabel];n.forEach((function(e,n){if(n<o.length&&o[n]){var a=Math.round(100*e.ratio),i=t.getAIDisplayName(e.vehicleId);o[n].string=i+": "+a+"%"}}));for(var a=n.length;a<o.length;a++)o[a]&&(o[a].string="")},i.getAIDisplayName=function(e){if(e.startsWith("ai_")){var t=e.split("_");if(t.length>=2)return"AI-"+t[1]}return e},i.initializeAIRatioDisplay=function(){[this.ai1RatioLabel,this.ai2RatioLabel,this.ai3RatioLabel,this.ai4RatioLabel].forEach((function(e,t){e?e.string="AI-"+(t+1)+": 0%":console.warn("GameHUD: AI"+(t+1)+"RatioLabel未设置")}))},i.resetHUD=function(){this.countdownLabel&&(this.countdownLabel.string="02:00",this.countdownLabel.color=new this.countdownLabel.color.constructor(255,255,255,255)),this.playerRatioLabel&&(this.playerRatioLabel.string="player: 0%"),this.initializeAIRatioDisplay()},i.initializeShootButton=function(){this.shootButton?this.shootButton.node.on(s.EventType.CLICK,this.onShootButtonClicked,this):console.warn("GameHUD: 射击按钮未设置")},i.onShootButtonClicked=function(){this.gameManager&&this.gameManager.playerShoot()},i.updateAmmoDisplay=function(){if(this.gameManager){var e=this.gameManager.getPlayerComponent();if(e){if(this.ammoLabel){var t=e.getCurrentAmmo(),n=e.getMaxAmmo();this.ammoLabel.string=t+"/"+n}this.reloadProgressBar&&(e.isReloading()?(this.reloadProgressBar.node.active=!0,this.reloadProgressBar.progress=e.getReloadProgress()):this.reloadProgressBar.node.active=!1)}}},i.initializeTouchControlButtons=function(){this.upButton?(this.upButton.node.on(c.EventType.TOUCH_START,this.onUpButtonPressed,this),this.upButton.node.on(c.EventType.TOUCH_END,this.onUpButtonReleased,this),this.upButton.node.on(c.EventType.TOUCH_CANCEL,this.onUpButtonReleased,this)):console.warn("GameHUD: 上移按钮未设置"),this.downButton?(this.downButton.node.on(c.EventType.TOUCH_START,this.onDownButtonPressed,this),this.downButton.node.on(c.EventType.TOUCH_END,this.onDownButtonReleased,this),this.downButton.node.on(c.EventType.TOUCH_CANCEL,this.onDownButtonReleased,this)):console.warn("GameHUD: 下移按钮未设置"),this.leftButton?(this.leftButton.node.on(c.EventType.TOUCH_START,this.onLeftButtonPressed,this),this.leftButton.node.on(c.EventType.TOUCH_END,this.onLeftButtonReleased,this),this.leftButton.node.on(c.EventType.TOUCH_CANCEL,this.onLeftButtonReleased,this)):console.warn("GameHUD: 左移按钮未设置"),this.rightButton?(this.rightButton.node.on(c.EventType.TOUCH_START,this.onRightButtonPressed,this),this.rightButton.node.on(c.EventType.TOUCH_END,this.onRightButtonReleased,this),this.rightButton.node.on(c.EventType.TOUCH_CANCEL,this.onRightButtonReleased,this)):console.warn("GameHUD: 右移按钮未设置")},i.onUpButtonPressed=function(){if(console.log("GameHUD: 上移按钮被按下"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家加速度为1"),e.setAcceleration(1)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},i.onUpButtonReleased=function(){if(console.log("GameHUD: 上移按钮被释放"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家加速度为0"),e.setAcceleration(0)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},i.onDownButtonPressed=function(){if(console.log("GameHUD: 下移按钮被按下"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家加速度为-1"),e.setAcceleration(-1)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},i.onDownButtonReleased=function(){if(console.log("GameHUD: 下移按钮被释放"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家加速度为0"),e.setAcceleration(0)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},i.onLeftButtonPressed=function(){if(console.log("GameHUD: 左移按钮被按下"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家转向为-1"),e.setDirection(-1)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},i.onLeftButtonReleased=function(){if(console.log("GameHUD: 左移按钮被释放"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家转向为0"),e.setDirection(0)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},i.onRightButtonPressed=function(){if(console.log("GameHUD: 右移按钮被按下"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家转向为1"),e.setDirection(1)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},i.onRightButtonReleased=function(){if(console.log("GameHUD: 右移按钮被释放"),this.gameManager){var e=this.gameManager.getPlayerComponent();e?(console.log("GameHUD: 设置玩家转向为0"),e.setDirection(0)):console.warn("GameHUD: 无法获取玩家组件")}else console.warn("GameHUD: GameManager未找到")},t}(g)).prototype,"countdownLabel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(M.prototype,"playerRatioLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(M.prototype,"ai1RatioLabel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(M.prototype,"ai2RatioLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(M.prototype,"ai3RatioLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(M.prototype,"ai4RatioLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(M.prototype,"shootButton",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(M.prototype,"ammoLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(M.prototype,"reloadProgressBar",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(M.prototype,"upButton",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(M.prototype,"downButton",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(M.prototype,"leftButton",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(M.prototype,"rightButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(M.prototype,"updateInterval",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),v=M))||v));i._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TempData.ts","./camera_follow.ts","./player.ts","./AIController.ts","./AIPlayer.ts","./PlayerManager.ts","./SceneTransition.ts","./SoundManager.ts","./PaintManager.ts","./GameOverPanel.ts","./GameHUD.ts","./Bullet.ts"],(function(e){var t,n,a,i,r,o,l,s,u,c,h,m,p,g,f,y,d,P,v,C,b,M,H,S,B,R,T,G,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.createForOfIteratorHelperLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,l=e._decorator,s=e.Node,u=e.ProgressBar,c=e.Label,h=e.Button,m=e.resources,p=e.Prefab,g=e.instantiate,f=e.UITransform,y=e.director,d=e.Component},function(e){P=e.TempData},function(e){v=e.CameraFollow},function(e){C=e.player},function(e){b=e.AIController},function(e){M=e.AIPlayer},function(e){H=e.PlayerManager},function(e){S=e.SceneTransition},function(e){B=e.SoundManager},function(e){R=e.PaintManager},function(e){T=e.GameOverPanel},function(e){G=e.GameHUD},function(e){w=e.Bullet}],execute:function(){var N,I,E,A,L,D,U,z,O,x,_,F,V,k,W,j,K,J,q,Q,X,Y,Z,$,ee,te,ne,ae;o._RF.push({},"b67f4UjjapGSoVG2Jvvuyl3","GameManager",void 0);var ie=l.ccclass,re=l.property,oe=e("GameState",function(e){return e.RUNNING="running",e.PAUSED="paused",e.GAME_OVER="game_over",e}({}));e("GameManager",(N=ie("GameManager"),I=re(s),E=re(s),A=re(s),L=re(s),D=re(u),U=re(c),z=re(h),O=re(s),x=re(s),_=re(h),F=re(h),V=re(G),N(((ae=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"playGround",j,r(t)),i(t,"canvas",K,r(t)),i(t,"spawnPoint",J,r(t)),i(t,"camera",q,r(t)),i(t,"playerHealthBar",Q,r(t)),i(t,"enemyCountLabel",X,r(t)),i(t,"pauseButton",Y,r(t)),i(t,"pausePanel",Z,r(t)),i(t,"gameOverPanel",$,r(t)),i(t,"resumeButton",ee,r(t)),i(t,"mainMenuButton",te,r(t)),t.aiPlayers=[],t.currentState=oe.RUNNING,t.gameStartTime=0,t.gameEndTime=0,t.gameDuration=90,t.remainingTime=90,t.playerHP=0,t.playerMaxHP=0,t.enemyCount=0,t.initialEnemyCount=0,t.playerComponent=null,t.paintManager=null,i(t,"gameHUD",ne,r(t)),t.bulletRoot=null,t}n(t,e),t.getInstance=function(){return t._instance};var o=t.prototype;return o.onLoad=function(){if(t._instance)return console.log("销毁原有单例"),void this.node.destroy();t._instance=this},o.start=function(){console.log("调用场景内容加载"),this.initializeGame(),this.bindButtonEvents(),this.loadLevelAndCar()},o.update=function(e){this.currentState===oe.RUNNING&&this.updateCountdown(e)},o.onDestroy=function(){t._instance===this&&(t._instance=null,console.log("GameManager 实例已销毁"))},o.initializeGame=function(){this.currentState=oe.RUNNING,this.gameStartTime=Date.now(),this.gameEndTime=0,this.remainingTime=this.gameDuration,this.pausePanel&&(this.pausePanel.active=!1),this.gameOverPanel&&(this.gameOverPanel.active=!1),this.gameHUD&&this.gameHUD.resetHUD()},o.bindButtonEvents=function(){this.pauseButton&&this.pauseButton.node.on(h.EventType.CLICK,this.pauseGame,this),this.resumeButton&&this.resumeButton.node.on(h.EventType.CLICK,this.resumeGame,this),this.mainMenuButton&&this.mainMenuButton.node.on(h.EventType.CLICK,this.returnToLevelSelect,this)},o.loadLevelAndCar=function(){var e=this,t=P.selectedLevel,n=P.selectedCar,a=null,i=null;t&&m.load("prefab/levels/"+t,p,(function(r,o){!r&&o&&((a=g(o)).setPosition(0,0,0),e.playGround.addChild(a),e.autoFindAIPlayers(),e.notifyAIControllers(),e.findBulletRoot(),e.initialEnemyCount=e.aiPlayers.length,e.refreshEnemyCount(e.initialEnemyCount),n&&m.load("prefab/cars/"+n,p,(function(t,r){if(!t&&r){i=g(r);var o=e.spawnPoint.children;if(o.length>0){var l=o[Math.floor(Math.random()*o.length)],s=l.getWorldPosition(),u=e.canvas.getComponent(f).convertToNodeSpaceAR(s);i.setPosition(u),i.setRotation(l.getRotation());var c=i.getComponent(C);c&&(c.init(l.angle),e.initializePlayerHealth(c)),-1!==["point4","point5","point6"].indexOf(l.name)&&console.log("生成车辆在右侧")}e.canvas.addChild(i);var h=e.camera.getComponent(v);h&&a&&i&&h.init(a,i),e.initializePaintSystem()}t?console.error("加载车辆预制体失败:",t,n):r||console.error("未找到车辆预制体:",n)}))),r?console.error("加载关卡预制体失败:",r,t):o||console.error("未找到关卡预制体:",t)})),B.instance.playSoundEffect("carStart")},o.autoFindAIPlayers=function(){this.aiPlayers=[];var e=this.node.scene;if(e){var t=e.getChildByName("Canvas");if(t){var n=t.getChildByName("PlayGround");if(n){var i=n.children[0];if(i){var r=i.getChildByName("cars");if(r)for(var o,l=a(r.children);!(o=l()).done;){var s=o.value.getComponent(M);s&&this.aiPlayers.push(s)}}}}}},o.getAIPlayers=function(){return this.aiPlayers},o.findBulletRoot=function(){var e=this.node.scene;e?(this.bulletRoot=e.getChildByName("BulletRoot")||this.findNodeRecursively(e,"BulletRoot"),this.bulletRoot?console.log("BulletRoot节点找到:",this.bulletRoot.name):console.warn("BulletRoot节点未找到，子弹将添加到场景根节点")):console.warn("场景未找到")},o.findNodeRecursively=function(e,t){for(var n,i=a(e.children);!(n=i()).done;){var r=n.value;if(r.name===t)return r;var o=this.findNodeRecursively(r,t);if(o)return o}return null},o.notifyAIControllers=function(){for(var e,t=this.node.scene.getComponentsInChildren(b),n=a(t);!(e=n()).done;){e.value.onScenePrefabLoaded()}},o.initializePlayerHealth=function(e){this.playerComponent=e,this.playerMaxHP=e.getMaxHealth(),this.playerHP=this.playerMaxHP,console.log("玩家血量初始化完成: "+this.playerHP+"/"+this.playerMaxHP),this.refreshPlayerHealthBar()},o.reducePlayerHP=function(e){console.log("减少玩家血量:",e),this.playerHP=Math.max(0,this.playerHP-e),this.refreshPlayerHealthBar(),this.playerHP<=0&&this.currentState===oe.RUNNING&&console.log("玩家血量归零，等待摧毁动画完成")},o.syncPlayerHealth=function(){this.playerComponent&&(this.playerHP=this.playerComponent.getCurrentHealth(),this.refreshPlayerHealthBar(),this.playerHP<=0&&this.currentState===oe.RUNNING&&console.log("玩家血量归零，等待摧毁动画完成"))},o.resetPlayerHealth=function(){this.playerComponent&&(this.playerComponent.restoreVehicle(),this.playerHP=this.playerMaxHP,this.refreshPlayerHealthBar(),console.log("玩家血量已重置: "+this.playerHP+"/"+this.playerMaxHP))},o.refreshPlayerHealthBar=function(){this.playerHealthBar&&this.playerMaxHP>0&&(this.playerHealthBar.progress=this.playerHP/this.playerMaxHP)},o.refreshEnemyCount=function(e){this.enemyCount=e,this.enemyCountLabel&&(this.enemyCountLabel.string="opponent: "+this.enemyCount),this.enemyCount<=0&&this.currentState===oe.RUNNING&&this.initialEnemyCount>0&&(console.log("所有AI车辆摧毁动画完成，触发游戏胜利"),this.gameOver(!0))},o.pauseGame=function(){this.currentState===oe.RUNNING&&(this.currentState=oe.PAUSED,y.pause(),this.pausePanel&&(this.pausePanel.active=!0),console.log("游戏已暂停"))},o.resumeGame=function(){this.currentState===oe.PAUSED&&(this.currentState=oe.RUNNING,y.resume(),this.pausePanel&&(this.pausePanel.active=!1),console.log("游戏已继续"))},o.gameOver=function(e){if(this.currentState!==oe.GAME_OVER){this.currentState=oe.GAME_OVER,this.gameEndTime=Date.now(),y.pause();var t=this.calculateGameResult(e);if(this.gameOverPanel){this.gameOverPanel.active=!0;var n=this.gameOverPanel.getComponent(T);n&&(n.bindButtonEvents(),n.setGameOverInfo(e,t.performance,t.reward,t.gameTime,t.healthPercentage,t.stars))}H.instance.addMoney(t.reward),this.updateLevelProgress(this.gameEndTime-this.gameStartTime,t.stars),console.log(e?"游戏胜利！":"游戏失败！")}},o.restartGame=function(){y.resume(),S.loadScene(y.getScene().name)},o.returnToLevelSelect=function(){y.resume(),S.loadScene("LevelSelect")},o.calculateGameResult=function(e){var t=(this.gameEndTime-this.gameStartTime)/1e3,n=this.playerHP/this.playerMaxHP;if(!e)return{performance:"failure",reward:10,gameTime:t,healthPercentage:n,stars:0};var a=this.calculateStars(t,n),i=this.calculatePerformance(t,n),r=i.performance,o=i.reward;return console.log("游戏时长: "+t.toFixed(1)+"秒, 生命值: "+(100*n).toFixed(1)+"%, 星星: "+a+", 评价: "+r+", 奖励: "+o+"金币"),{performance:r,reward:o,gameTime:t,healthPercentage:n,stars:a}},o.calculateStars=function(e,t){if(!this.paintManager)return 1;var n=this.paintManager.getPaintCountByOwner("player"),a=this.paintManager.getTotalPaintCount();if(0===a)return 1;var i=100*(n/a),r=this.enemyCount<=0&&this.initialEnemyCount>0;return i>=45?3:i>=35?2:i>=25||r?1:0},o.updateLevelProgress=function(e,t){var n=P.selectedLevel;n?(H.instance.updateLevelProgress(n,e,t),console.log("关卡进度已更新: "+n+", 时间: "+e+"ms, 星星: "+t)):console.warn("无法获取当前关卡ID")},o.calculatePerformance=function(e,t){var n,a;switch(this.calculateStars(e,t)){case 3:n="A",a=500;break;case 2:n="B",a=300;break;case 1:n="C",a=200;break;default:n="F",a=50}return{performance:n,reward:a}},o.getCurrentState=function(){return this.currentState},o.getGameTime=function(){return this.gameEndTime>0?(this.gameEndTime-this.gameStartTime)/1e3:(Date.now()-this.gameStartTime)/1e3},o.getPlayerHP=function(){return this.playerHP},o.getPlayerMaxHP=function(){return this.playerMaxHP},o.getEnemyCount=function(){return this.enemyCount},o.initializePaintSystem=function(){this.paintManager=this.node.scene.getComponentInChildren(R)},o.clearAllPaint=function(){this.paintManager&&this.paintManager.clearAllPaint()},o.sprayPaint=function(e,t,n){this.paintManager&&e?this.paintManager.addPaint(e,t,n):console.warn("GameManager: 无法喷洒颜料，PaintManager或颜料预制体为空")},o.getAllVehiclePaintRatios=function(){return this.paintManager?this.paintManager.getAllPaintRatios():{}},o.getSortedVehiclePaintRatios=function(){return this.paintManager?this.paintManager.getSortedPaintRatios().map((function(e){return{vehicleId:e.ownerId,ratio:e.ratio,count:e.count}})):[]},o.getPaintManager=function(){return this.paintManager},o.updateCountdown=function(e){this.remainingTime-=e,this.remainingTime<=0&&(this.remainingTime=0,this.onCountdownFinished())},o.onCountdownFinished=function(){console.log("倒计时结束，游戏结束"),this.gameOver(this.determineWinner())},o.determineWinner=function(){if(this.playerHP<=0)return console.log("玩家已死亡，游戏失败"),!1;if(this.enemyCount<=0&&this.initialEnemyCount>0)return console.log("所有AI车辆已被摧毁，游戏胜利"),!0;if(!this.paintManager)return!1;var e=this.paintManager.getPaintCountByOwner("player"),t=this.paintManager.getTotalPaintCount();if(0===t)return!1;var n=e/t;return console.log("玩家颜料占比: "+(100*n).toFixed(1)+"%"),n>.25?(console.log("玩家颜料占比超过25%，游戏胜利"),!0):(console.log("玩家颜料占比不足25%，游戏失败"),!1)},o.getRemainingTime=function(){return Math.max(0,this.remainingTime)},o.getFormattedRemainingTime=function(){var e=Math.ceil(this.getRemainingTime()),t=Math.floor(e/60),n=e%60;return(t<10?"0"+t:t.toString())+":"+(n<10?"0"+n:n.toString())},o.playerShoot=function(){this.playerComponent&&this.playerComponent.shoot()},o.fireBullet=function(e,t,n,a,i){var r=g(e),o=r.getComponent(w);if(o&&(o.init(n,a),o.bulletType=i),this.bulletRoot){var l,s=null==(l=this.bulletRoot.getComponent(f))?void 0:l.convertToNodeSpaceAR(t);s?r.setPosition(s):r.setWorldPosition(t),this.bulletRoot.addChild(r),console.log("子弹已添加到BulletRoot节点")}},o.getPlayerComponent=function(){return this.playerComponent},t}(d))._instance=null,j=t((W=ae).prototype,"playGround",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(W.prototype,"canvas",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(W.prototype,"spawnPoint",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(W.prototype,"camera",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(W.prototype,"playerHealthBar",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(W.prototype,"enemyCountLabel",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(W.prototype,"pauseButton",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(W.prototype,"pausePanel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(W.prototype,"gameOverPanel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(W.prototype,"resumeButton",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(W.prototype,"mainMenuButton",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=t(W.prototype,"gameHUD",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=W))||k));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameOverPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(e){var t,i,r,n,a,l,o,u,s,c,p,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,l=e._decorator,o=e.Label,u=e.Sprite,s=e.Button,c=e.Color,p=e.Component},function(e){b=e.GameManager}],execute:function(){var f,h,L,y,g,m,v,S,d,R,w,B,I,C,z,P,T,A,G,k,D,E,M,_,K,O,F,j,x,N,V;a._RF.push({},"85096jcoYBCMKDGuUlvynIB","GameOverPanel",void 0);var H=l.ccclass,U=l.property;e("GameOverPanel",(f=H("GameOverPanel"),h=U(o),L=U(o),y=U(o),g=U(o),m=U({type:u,tooltip:"第1颗星星精灵"}),v=U({type:u,tooltip:"第2颗星星精灵"}),S=U({type:u,tooltip:"第3颗星星精灵"}),d=U(o),R=U({type:o,tooltip:"AI车辆1的颜料占比显示标签"}),w=U({type:o,tooltip:"AI车辆2的颜料占比显示标签"}),B=U({type:o,tooltip:"AI车辆3的颜料占比显示标签"}),I=U({type:o,tooltip:"AI车辆4的颜料占比显示标签"}),C=U(s),z=U(s),f((A=t((T=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),l=0;l<i;l++)a[l]=arguments[l];return t=e.call.apply(e,[this].concat(a))||this,r(t,"titleLabel",A,n(t)),r(t,"performanceLabel",G,n(t)),r(t,"rewardLabel",k,n(t)),r(t,"gameTimeLabel",D,n(t)),r(t,"star1Sprite",E,n(t)),r(t,"star2Sprite",M,n(t)),r(t,"star3Sprite",_,n(t)),r(t,"playerRatioLabel",K,n(t)),r(t,"ai1RatioLabel",O,n(t)),r(t,"ai2RatioLabel",F,n(t)),r(t,"ai3RatioLabel",j,n(t)),r(t,"ai4RatioLabel",x,n(t)),r(t,"restartButton",N,n(t)),r(t,"LevelSelectButton",V,n(t)),t}i(t,e);var a=t.prototype;return a.start=function(){},a.bindButtonEvents=function(){this.restartButton&&this.restartButton.node.on(s.EventType.CLICK,this.onRestartClick,this),this.LevelSelectButton&&this.LevelSelectButton.node.on(s.EventType.CLICK,this.onLevelSelectClick,this)},a.updatePaintRatios=function(){var e=this,t=b.getInstance();if(t){var i=t.getAllVehiclePaintRatios().player||0,r=Math.round(100*i);this.playerRatioLabel&&(this.playerRatioLabel.string="player: "+r+"%");var n=t.getSortedVehiclePaintRatios().filter((function(e){return"player"!==e.vehicleId})),a=[this.ai1RatioLabel,this.ai2RatioLabel,this.ai3RatioLabel,this.ai4RatioLabel];n.forEach((function(t,i){if(i<a.length&&a[i]){var r=Math.round(100*t.ratio),n=e.getAIDisplayName(t.vehicleId);a[i].string=n+": "+r+"%"}}));for(var l=n.length;l<a.length;l++)a[l]&&(a[l].string="")}},a.getAIDisplayName=function(e){if(e.startsWith("ai_")){var t=e.split("_");if(t.length>=2)return"AI-"+t[1]}return e},a.updateStarSprites=function(e){[this.star1Sprite,this.star2Sprite,this.star3Sprite].forEach((function(t,i){t&&(t.color=new c(255,255,255,i<e?255:100))})),console.log("更新星星显示: "+e+"/3 颗星星亮起")},a.onRestartClick=function(){var e=b.getInstance();e&&e.restartGame()},a.onLevelSelectClick=function(){var e=b.getInstance();e&&e.returnToLevelSelect()},a.setGameOverInfo=function(e,t,i,r,n,a){this.titleLabel&&(this.titleLabel.string=e?"winner":"loser"),this.performanceLabel&&(this.performanceLabel.string="performance: "+t),this.rewardLabel&&(this.rewardLabel.string="reward: "+i),this.gameTimeLabel&&(this.gameTimeLabel.string="time: "+r.toFixed(1)+"S"),this.updateStarSprites(a),this.updatePaintRatios()},a.onDestroy=function(){this.restartButton&&this.restartButton.node&&this.restartButton.node.off(s.EventType.CLICK,this.onRestartClick,this),this.LevelSelectButton&&this.LevelSelectButton.node&&this.LevelSelectButton.node.off(s.EventType.CLICK,this.onLevelSelectClick,this)},t}(p)).prototype,"titleLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(T.prototype,"performanceLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(T.prototype,"rewardLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(T.prototype,"gameTimeLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(T.prototype,"star1Sprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(T.prototype,"star2Sprite",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(T.prototype,"star3Sprite",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(T.prototype,"playerRatioLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(T.prototype,"ai1RatioLabel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(T.prototype,"ai2RatioLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(T.prototype,"ai3RatioLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(T.prototype,"ai4RatioLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(T.prototype,"restartButton",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(T.prototype,"LevelSelectButton",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=T))||P));a._RF.pop()}}}));

System.register("chunks:///_virtual/HealthBarUI.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,s,a,r;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,a=t._decorator,r=t.Component}],execute:function(){var c,l,h;s._RF.push({},"79d6fgSlVRCYoTh/XQ+YRv5","HealthBarUI",void 0);var u=a.ccclass,f=a.property;t("HealthBarUI",u("HealthBarUI")((h=e((l=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,n(e,"offsetY",h,o(e)),e.targetNode=null,e.canvas=null,e.isInitialized=!1,e}i(e,t);var s=e.prototype;return s.start=function(){this.setupCanvas(),this.targetNode=this.node.parent,this.separateFromParent(),console.log("血条UI初始化完成")},s.setupCanvas=function(){this.canvas=this.node.scene.getChildByName("Canvas"),this.canvas||console.error("未找到Canvas节点，血条可能无法正确显示")},s.separateFromParent=function(){if(this.canvas&&this.targetNode){var t=this.node.worldPosition;this.node.setParent(this.canvas),this.node.setWorldPosition(t),this.isInitialized=!0,console.log("血条已分离到Canvas下")}},s.update=function(){this.isInitialized&&this.targetNode&&this.canvas&&this.updatePosition()},s.updatePosition=function(){var t=this.targetNode.worldPosition;this.node.setWorldPosition(t.x,t.y+this.offsetY,t.z),this.node.setRotationFromEuler(0,0,0)},s.setOffsetY=function(t){this.offsetY=t},s.setVisible=function(t){this.node.active=t},s.getOffsetY=function(){return this.offsetY},s.setTarget=function(t){this.targetNode=t},s.destroyHealthBar=function(){this.node.destroy()},e}(r)).prototype,"offsetY",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),c=l))||c);s._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AIController.ts","./AIPlayer.ts","./Bullet.ts","./CarProperties.ts","./CarPropertyDisplay.ts","./GameHUD.ts","./GameManager.ts","./GameOverPanel.ts","./HealthBarUI.ts","./MainMenuController.ts","./PaintManager.ts","./PaintSpot.ts","./PausePanel.ts","./PlayerInfoUI.ts","./PlayerManager.ts","./PurchasePanel.ts","./SceneTransition.ts","./SelectManager.ts","./SoundManager.ts","./TempData.ts","./camera_follow.ts","./player.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainMenuController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneTransition.ts","./SoundManager.ts"],(function(t){var e,n,i,l,o,a,r,u,s,c,p,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,l=t.assertThisInitialized},function(t){o=t.cclegacy,a=t._decorator,r=t.Button,u=t.Node,s=t.Label,c=t.Component},function(t){p=t.SceneTransition},function(t){h=t.SoundManager}],execute:function(){var d,f,b,g,B,y,C,v,P,m,L,S,M,z,w,T,A,E,I,K,G;o._RF.push({},"0cf64BckYpA8bODaKn8c5t/","MainMenuController",void 0);var k=a.ccclass,H=a.property;t("MainMenuController",(d=k("MainMenuController"),f=H(r),b=H(r),g=H(r),B=H(r),y=H(u),C=H(s),v=H(r),P=H(r),m=H(u),d((M=e((S=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,i(e,"startGameBtn",M,l(e)),i(e,"settingBtn",z,l(e)),i(e,"closesettingBtn",w,l(e)),i(e,"audioBtn",T,l(e)),i(e,"settingPanel",A,l(e)),i(e,"audioLabel",E,l(e)),i(e,"helpButton",I,l(e)),i(e,"closehelpBtn",K,l(e)),i(e,"helpPanel",G,l(e)),e}n(e,t);var o=e.prototype;return o.start=function(){this.startGameBtn&&this.startGameBtn.node.on(r.EventType.CLICK,this.onStartGame,this),this.settingBtn&&this.settingBtn.node.on(r.EventType.CLICK,this.displaySettingPanel,this),this.closesettingBtn&&this.closesettingBtn.node.on(r.EventType.CLICK,this.hideSettingPanel,this),this.helpButton&&this.helpButton.node.on(r.EventType.CLICK,this.displayHelpPanel,this),this.closehelpBtn&&this.closehelpBtn.node.on(r.EventType.CLICK,this.hideHelpPanel,this),this.audioBtn&&this.audioBtn.node.on(r.EventType.CLICK,this.onAudioClick,this),this.updateAudioButtonLabel()},o.displaySettingPanel=function(){this.settingPanel.active=!0},o.hideSettingPanel=function(){this.settingPanel.active=!1},o.displayHelpPanel=function(){this.helpPanel.active=!0},o.hideHelpPanel=function(){this.helpPanel.active=!1},o.onAudioClick=function(){h.instance.toggleAudio(),this.updateAudioButtonLabel()},o.updateAudioButtonLabel=function(){this.audioLabel&&(this.audioLabel.string=h.instance.isMuted()?"音效:关":"音效:开")},o.onStartGame=function(){h.instance.playSoundEffect("buttonClick"),p.loadScene("LevelSelect")},e}(c)).prototype,"startGameBtn",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(S.prototype,"settingBtn",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(S.prototype,"closesettingBtn",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(S.prototype,"audioBtn",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(S.prototype,"settingPanel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(S.prototype,"audioLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(S.prototype,"helpButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(S.prototype,"closehelpBtn",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(S.prototype,"helpPanel",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=S))||L));o._RF.pop()}}}));

System.register("chunks:///_virtual/PaintManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,i,e,a,o,r,s,c,u,p,l,h,d,f;return{setters:[function(n){t=n.applyDecoratedDescriptor,i=n.inheritsLoose,e=n.createForOfIteratorHelperLoose,a=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){r=n.cclegacy,s=n._decorator,c=n.Node,u=n.Layers,p=n.UITransform,l=n.Vec2,h=n.instantiate,d=n.Vec3,f=n.Component}],execute:function(){var g,v,P,y;r._RF.push({},"7dd7aydfZBHRbtWPJmh00Xf","PaintManager",void 0);var C=s.ccclass,w=s.property;n("PaintManager",C("PaintManager")(((y=function(n){function t(){for(var t,i=arguments.length,e=new Array(i),r=0;r<i;r++)e[r]=arguments[r];return(t=n.call.apply(n,[this].concat(e))||this).paintMap=new Map,a(t,"coverageRadius",P,o(t)),t.paintContainer=null,t}i(t,n),t.getInstance=function(){return t._instance};var r=t.prototype;return r.onLoad=function(){if(t._instance)return console.log("销毁原有PaintManager单例"),void this.node.destroy();t._instance=this,this.paintContainer=new c("PaintContainer"),this.paintContainer.layer=u.Enum.UI_2D,this.node.addChild(this.paintContainer),console.log("PaintManager初始化完成")},r.onDestroy=function(){t._instance===this&&(t._instance=null,console.log("PaintManager实例已销毁"))},r.addPaint=function(n,t,i){if(n&&this.paintContainer){if(!this.paintContainer.getComponent(p))this.paintContainer.addComponent(p).setContentSize(1280,720);var e=this.paintContainer.getComponent(p).convertToNodeSpaceAR(t),a=new l(e.x,e.y);if(!this.isNearOwnPaint(a,i)){this.checkAndRemoveOverlappingPaint(a,i);var o=h(n);o.setPosition(e),o.layer=u.Enum.UI_2D,this.paintContainer.addChild(o);var r=this.generatePaintId(a,i),s={node:o,position:a,ownerId:i,timestamp:Date.now()};this.paintMap.set(r,s)}}else console.warn("PaintManager: 颜料预制体或容器为空")},r.checkAndRemoveOverlappingPaint=function(n,t){var i=this,e=[];this.paintMap.forEach((function(a,o){l.distance(a.position,n)<i.coverageRadius&&a.ownerId!==t&&e.push(o)})),e.forEach((function(n){i.removePaint(n)}))},r.removePaint=function(n){var t=this.paintMap.get(n);t&&(t.node&&t.node.isValid&&t.node.destroy(),this.paintMap.delete(n))},r.removePaintById=function(n){this.removePaint(n)},r.isNearOwnPaint=function(n,t){for(var i,a=e(this.paintMap.values());!(i=a()).done;){var o=i.value;if(o.ownerId===t)if(l.distance(o.position,n)<this.coverageRadius)return!0}return!1},r.generatePaintId=function(n,t){var i=Date.now();return"paint_"+t+"_"+n.x.toFixed(0)+"_"+n.y.toFixed(0)+"_"+i},r.clearAllPaint=function(){this.paintMap.forEach((function(n){n.node&&n.node.isValid&&n.node.destroy()})),this.paintMap.clear(),console.log("清除了所有颜料")},r.getPaintCountByOwner=function(n){var t=0;return this.paintMap.forEach((function(i){i.ownerId===n&&t++})),t},r.getTotalPaintCount=function(){return this.paintMap.size},r.getPaintRatioByOwner=function(n){var t=this.getTotalPaintCount();return 0===t?0:this.getPaintCountByOwner(n)/t},r.getAllPaintRatios=function(){var n={},t=this.getTotalPaintCount();if(0===t)return n;var i={};for(var e in this.paintMap.forEach((function(n){var t=n.ownerId;i[t]=(i[t]||0)+1})),i)n[e]=i[e]/t;return n},r.getSortedPaintRatios=function(){var n=this.getAllPaintRatios(),t=[];for(var i in n)t.push({ownerId:i,ratio:n[i],count:this.getPaintCountByOwner(i)});return t.sort((function(n,t){return t.ratio-n.ratio})),t},r.clearPaintInRange=function(n,t){var i=this;if(!this.paintContainer)return console.warn("PaintManager: 颜料容器未初始化"),0;var e=this.paintContainer.getComponent(p);if(!e)return console.warn("PaintManager: 颜料容器缺少UITransform组件"),0;var a=new d(n.x,n.y,0),o=e.convertToNodeSpaceAR(a),r=new l(o.x,o.y),s=[];return this.paintMap.forEach((function(n,i){l.distance(n.position,r)<=t&&s.push(i)})),s.forEach((function(n){i.removePaint(n)})),console.log("清除了 "+s.length+" 个范围内的颜料"),s.length},t}(f))._instance=null,P=t((v=y).prototype,"coverageRadius",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),g=v))||g);r._RF.pop()}}}));

System.register("chunks:///_virtual/PaintSpot.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,a,c,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,c=t.Sprite,l=t.Component}],execute:function(){var s,p,u,f;r._RF.push({},"e9c7fJf5G9M8ZAl2uR3FDyp","PaintSpot",void 0);var h=a.ccclass,d=a.property;t("PaintSpot",h("PaintSpot")((u=e((p=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,n(e,"fadeTime",u,o(e)),n(e,"enableFade",f,o(e)),e.sprite=null,e.originalAlpha=1,e.creationTime=0,e}i(e,t);var r=e.prototype;return r.onLoad=function(){this.sprite=this.getComponent(c),this.sprite&&(this.originalAlpha=this.sprite.color.a/255),this.creationTime=Date.now()},r.start=function(){this.playSpawnAnimation()},r.update=function(t){},r.playSpawnAnimation=function(){var t=this;this.node&&(this.node.setScale(.1,.1,1),this.scheduleOnce((function(){t.node&&t.node.isValid&&t.node.setScale(1,1,1)}),.1))},e}(l)).prototype,"fadeTime",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),f=e(p.prototype,"enableFade",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=p))||s);r._RF.pop()}}}));

System.register("chunks:///_virtual/PausePanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(t){var n,e,i,o,r,u,s,a,c;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,u=t._decorator,s=t.Button,a=t.Component},function(t){c=t.GameManager}],execute:function(){var l,h,p,f,m,C,B,v,y;r._RF.push({},"5a320cJxNpIpp4K8fCIQRf7","PausePanel",void 0);var M=u.ccclass,d=u.property;t("PausePanel",(l=M("PausePanel"),h=d(s),p=d(s),f=d(s),l((B=n((C=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),u=0;u<e;u++)r[u]=arguments[u];return n=t.call.apply(t,[this].concat(r))||this,i(n,"resumeButton",B,o(n)),i(n,"restartButton",v,o(n)),i(n,"mainMenuButton",y,o(n)),n}e(n,t);var r=n.prototype;return r.start=function(){this.bindButtonEvents()},r.bindButtonEvents=function(){this.resumeButton&&this.resumeButton.node.on(s.EventType.CLICK,this.onResumeClick,this),this.restartButton&&this.restartButton.node.on(s.EventType.CLICK,this.onRestartClick,this),this.mainMenuButton&&this.mainMenuButton.node.on(s.EventType.CLICK,this.onMainMenuClick,this)},r.onResumeClick=function(){var t=c.getInstance();t&&t.resumeGame()},r.onRestartClick=function(){var t=c.getInstance();t&&t.restartGame()},r.onMainMenuClick=function(){var t=c.getInstance();t&&t.returnToMainMenu()},r.onDestroy=function(){this.resumeButton&&this.resumeButton.node.off(s.EventType.CLICK,this.onResumeClick,this),this.restartButton&&this.restartButton.node.off(s.EventType.CLICK,this.onRestartClick,this),this.mainMenuButton&&this.mainMenuButton.node.off(s.EventType.CLICK,this.onMainMenuClick,this)},n}(a)).prototype,"resumeButton",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=n(C.prototype,"restartButton",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=n(C.prototype,"mainMenuButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=C))||m));r._RF.pop()}}}));

System.register("chunks:///_virtual/player.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AIPlayer.ts","./GameManager.ts","./SoundManager.ts","./Bullet.ts"],(function(e){var i,t,n,o,r,a,s,l,c,h,d,u,p,y,_,g,f,m,b,v,D,w,A,R;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,s=e.SpriteFrame,l=e.Prefab,c=e.Vec2,h=e.input,d=e.Input,u=e.BoxCollider2D,p=e.Contact2DType,y=e.RigidBody2D,_=e.ERigidBody2DType,g=e.Sprite,f=e.KeyCode,m=e.tween,b=e.Vec3,v=e.Component},function(e){D=e.AIPlayer},function(e){w=e.GameManager},function(e){A=e.SoundManager},function(e){R=e.WeaponType}],execute:function(){var P,B,T,S,E,x,C,V,I,M,z,F,k,H,K,O,W,N,U,L,Y,G,J,j,q,Q,Z,X;r._RF.push({},"b39243E9/5JHJc2plQZwxL1","player",void 0);var $=a.ccclass,ee=a.property;e("player",(P=$("player"),B=ee(s),T=ee(l),S=ee({type:l,tooltip:"普通子弹预制体"}),E=ee({type:l,tooltip:"火箭弹预制体"}),x=ee({tooltip:"射速（发/秒）"}),C=ee({type:R,tooltip:"武器类型"}),V=ee({tooltip:"最大弹药数量"}),I=ee({tooltip:"弹药补充时间（秒）"}),P((F=i((z=function(e){function i(){for(var i,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r))||this,n(i,"maxSpeed",F,o(i)),n(i,"acceleration",k,o(i)),n(i,"brakeDeceleration",H,o(i)),n(i,"turnSpeed",K,o(i)),n(i,"friction",O,o(i)),n(i,"initAngle",W,o(i)),n(i,"maxHealth",N,o(i)),n(i,"destroyedSprite",U,o(i)),n(i,"removeDelay",L,o(i)),n(i,"paintPrefab",Y,o(i)),n(i,"paintSprayInterval",G,o(i)),n(i,"normalBulletPrefab",J,o(i)),n(i,"rocketPrefab",j,o(i)),n(i,"fireRate",q,o(i)),n(i,"weaponType",Q,o(i)),n(i,"maxAmmo",Z,o(i)),n(i,"ammoReloadTime",X,o(i)),i._rigidBody=null,i._direction=0,i._accel=0,i._angle=-90,i._targetAngle=-90,i._lastValidPosition=new c,i._currentHealth=100,i._isDestroyed=!1,i._originalSprite=null,i._paintTimer=0,i._vehicleId="player",i._canFire=!0,i._fireTimer=0,i._currentAmmo=20,i._isReloading=!1,i._reloadTimer=0,i}t(i,e);var r=i.prototype;return r.onLoad=function(){this._rigidBody=null,this._direction=0,this._accel=0,this._angle=-90,this._targetAngle=-90,this._lastValidPosition=new c,this._currentHealth=this.maxHealth,this._isDestroyed=!1,this._paintTimer=0,this._vehicleId="player",this._canFire=!0,this._fireTimer=0,this._currentAmmo=this.maxAmmo,this._isReloading=!1,this._reloadTimer=0},r.onEnable=function(){h.on(d.EventType.KEY_DOWN,this.onKeyDown,this),h.on(d.EventType.KEY_UP,this.onKeyUp,this)},r.onDisable=function(){h.off(d.EventType.KEY_DOWN,this.onKeyDown,this),h.off(d.EventType.KEY_UP,this.onKeyUp,this)},r.onDestroy=function(){h.off(d.EventType.KEY_DOWN,this.onKeyDown,this),h.off(d.EventType.KEY_UP,this.onKeyUp,this),this._rigidBody=null;var e=this.getComponent(u);e&&e.off(p.BEGIN_CONTACT,this.onBeginContact,this)},r.start=function(){if(this._rigidBody=this.getComponent(y),this._rigidBody&&this.node&&this.node.isValid){this._rigidBody.type=_.Dynamic,this._rigidBody.allowSleep=!1,this._rigidBody.gravityScale=0,this._rigidBody.linearDamping=.3,this._rigidBody.angularDamping=.9,this._rigidBody.fixedRotation=!0,this._lastValidPosition=new c(this.node.worldPosition.x,this.node.worldPosition.y),this._angle=this.initAngle,this._targetAngle=this.initAngle,this.node.setRotationFromEuler(0,0,this.initAngle);var e=this.getComponent(g);e&&e.spriteFrame&&(this._originalSprite=e.spriteFrame);var i=this.getComponent(u);i?(console.log("BoxCollider2D component found and registered"),i.on(p.BEGIN_CONTACT,this.onBeginContact,this)):console.error("BoxCollider2D component not found")}else console.error("player requires RigidBody2D component and valid node")},r.onKeyDown=function(e){switch(e.keyCode){case f.ARROW_UP:this._accel=1;break;case f.ARROW_DOWN:this._accel=-1;break;case f.ARROW_LEFT:A.instance.playSoundEffect("carDrift"),this._direction=-1;break;case f.ARROW_RIGHT:A.instance.playSoundEffect("carDrift"),this._direction=1;break;case f.SPACE:this.shoot()}},r.onKeyUp=function(e){switch(e.keyCode){case f.ARROW_UP:1===this._accel&&(this._accel=0);break;case f.ARROW_DOWN:-1===this._accel&&(this._accel=0);break;case f.ARROW_LEFT:-1===this._direction&&(this._direction=0);break;case f.ARROW_RIGHT:1===this._direction&&(this._direction=0)}},r.update=function(e){if(this._rigidBody&&this.node&&this.node.isValid&&!this._isDestroyed){var i=this._rigidBody.linearVelocity,t=i.length(),n=new c(this.node.worldPosition.x,this.node.worldPosition.y);if(0!==this._direction){var o=this.turnSpeed*e*this._direction;this._targetAngle-=o}var r=this._targetAngle-this._angle;if(Math.abs(r)>.1?this._angle+=.1*r:this._angle=this._targetAngle,this.node.setRotationFromEuler(0,0,this._angle),1===this._accel){var a=(this._angle+90)*Math.PI/180,s=new c(Math.cos(a)*this.acceleration,Math.sin(a)*this.acceleration);this._rigidBody.applyForce(s,n,!0)}else if(-1===this._accel){var l=(this._angle+90)*Math.PI/180,h=new c(Math.cos(l),Math.sin(l));if(i.dot(h)>0){var d=h.clone().multiplyScalar(-this.brakeDeceleration);this._rigidBody.applyForce(d,n,!0)}else{var u=h.clone().multiplyScalar(.5*-this.acceleration);this._rigidBody.applyForce(u,n,!0)}}else if(t>1){var p=i.clone().multiplyScalar(2*-this.friction);this._rigidBody.applyForce(p,n,!0)}if(t>this.maxSpeed){var y=i.clone().normalize();this._rigidBody.linearVelocity=y.multiplyScalar(this.maxSpeed)}if(t<.1)c.distance(n,this._lastValidPosition)>50&&(this.node.setWorldPosition(this._lastValidPosition.x,this._lastValidPosition.y,this.node.worldPosition.z),this._rigidBody.linearVelocity=new c(0,0));else this._lastValidPosition=n.clone();Math.abs(this._angle)>360&&(this._angle=this._angle%360,this._targetAngle=this._targetAngle%360),this.updatePaintSpray(e),this.updateWeaponSystem(e)}},r.init=function(e){this.initAngle=e,this._angle=e,this._targetAngle=e,this.node.setRotationFromEuler(0,0,e)},r.getRigidBody=function(){return this._rigidBody},r.onBeginContact=function(e,i,t){A.instance.playSoundEffect("carCollision"),console.log("玩家车辆发生碰撞，碰撞对象:",i.node.name);var n=i.node,o=n.getComponent(D);if(o){console.log("碰撞对象是AI车辆:",n.name);var r=this._rigidBody.linearVelocity.length(),a=o.node.getComponent(y),s=a?a.linearVelocity.length():0,l=Math.round(.5*r),h=Math.round(.5*s);o.takeDamage(l);var d=new c(this._rigidBody.linearVelocity.x,this._rigidBody.linearVelocity.y);d.normalize(),d.multiplyScalar(.05*-r),this._rigidBody.linearVelocity=d,this.takeDamage(h)}else{var u=this._rigidBody.linearVelocity.length(),p=Math.round(.3*u),_=new c(this._rigidBody.linearVelocity.x,this._rigidBody.linearVelocity.y);_.normalize(),_.multiplyScalar(.05*-u),this._rigidBody.linearVelocity=_,this.takeDamage(p)}},r.takeDamage=function(e){if(!this._isDestroyed){this._currentHealth=Math.max(0,this._currentHealth-e),console.log("玩家受到伤害: "+e+", 剩余生命值: "+this._currentHealth);var i=w.getInstance();i&&i.syncPlayerHealth(),this._currentHealth<=0&&this.destroyVehicle()}},r.destroyVehicle=function(){if(!this._isDestroyed){if(A.instance.playSoundEffect("carDestruction"),this._isDestroyed=!0,console.log("玩家车辆被摧毁！"),this.destroyedSprite){var e=this.getComponent(g);e&&(e.spriteFrame=this.destroyedSprite)}this.disableInput(),this.startDestroyAnimation()}},r.disableInput=function(){h.off(d.EventType.KEY_DOWN,this.onKeyDown,this),h.off(d.EventType.KEY_UP,this.onKeyUp,this),this._direction=0,this._accel=0},r.removeVehicleNode=function(){this.node&&this.node.isValid&&(console.log("移除玩家车辆节点"),this.node.removeFromParent())},r.startDestroyAnimation=function(){var e=this;this.node&&m(this.node).to(2,{scale:new b(1,1,1),angle:this.node.angle+180}).call((function(){e.onDestroyAnimationComplete()})).start()},r.onDestroyAnimationComplete=function(){console.log("玩家车辆摧毁动画完成，触发游戏结束");var e=w.getInstance();e&&e.gameOver(!1)},r.getCurrentHealth=function(){return this._currentHealth},r.getMaxHealth=function(){return this.maxHealth},r.isDestroyed=function(){return this._isDestroyed},r.restoreVehicle=function(){if(this.unschedule(this.removeVehicleNode),this._isDestroyed=!1,this._currentHealth=this.maxHealth,this._originalSprite){var e=this.getComponent(g);e&&(e.spriteFrame=this._originalSprite)}this.onEnable(),this.node&&(this.node.setScale(1,1),this.node.angle=this.initAngle),this._rigidBody&&(this._rigidBody.linearVelocity=new c(0,0)),console.log("玩家车辆已恢复")},r.updatePaintSpray=function(e){!this._isDestroyed&&this.paintPrefab&&(this._paintTimer+=e,this._paintTimer>=this.paintSprayInterval&&(this.sprayPaint(),this._paintTimer=0))},r.sprayPaint=function(){var e=w.getInstance();if(e){var i=this.node.getWorldPosition();e.sprayPaint(this.paintPrefab,i,this._vehicleId)}else console.warn("GameManager未找到，无法喷洒颜料")},r.updateWeaponSystem=function(e){if(!this._isDestroyed){this._fireTimer+=e;var i=1/this.fireRate;this._fireTimer>=i&&(this._canFire=!0),this.updateAmmoReload(e)}},r.updateAmmoReload=function(e){this._isReloading&&(this._reloadTimer+=e,this._reloadTimer>=this.ammoReloadTime&&(this._currentAmmo=this.maxAmmo,this._isReloading=!1,this._reloadTimer=0,console.log("弹药补充完成！")))},r.shoot=function(){if(this._canFire&&!this._isDestroyed)if(this._currentAmmo<=0)this._isReloading||this.startReload();else{this._canFire=!1,this._fireTimer=0,this._currentAmmo--;var e=null;switch(this.weaponType){case R.NORMAL:console.log("发射普通子弹"),e=this.normalBulletPrefab;break;case R.ROCKET:e=this.rocketPrefab}if(!e)return console.warn("子弹预制体未设置"),void(this._canFire=!0);var i=(this._angle+90)*Math.PI/180,t=new c(Math.cos(i),Math.sin(i)),n=this.node.worldPosition,o=new b(n.x+30*t.x,n.y+30*t.y,n.z),r=w.getInstance();r&&r.fireBullet(e,o,t,this._vehicleId,this.weaponType),A.instance.playSoundEffect("weaponFire"),this._currentAmmo<=0&&!this._isReloading&&this.startReload()}},r.startReload=function(){this._isReloading=!0,this._reloadTimer=0,console.log("开始补充弹药...")},r.getCurrentAmmo=function(){return this._currentAmmo},r.getMaxAmmo=function(){return this.maxAmmo},r.isReloading=function(){return this._isReloading},r.getReloadProgress=function(){return this._isReloading?this._reloadTimer/this.ammoReloadTime:1},r.setAcceleration=function(e){console.log("Player: 设置加速度为 "+e),this._accel=e},r.setDirection=function(e){console.log("Player: 设置转向为 "+e),0!==e&&0===this._direction&&A.instance.playSoundEffect("carDrift"),this._direction=e},r.getAcceleration=function(){return this._accel},r.getDirection=function(){return this._direction},i}(v)).prototype,"maxSpeed",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),k=i(z.prototype,"acceleration",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),H=i(z.prototype,"brakeDeceleration",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),K=i(z.prototype,"turnSpeed",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),O=i(z.prototype,"friction",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),W=i(z.prototype,"initAngle",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),N=i(z.prototype,"maxHealth",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),U=i(z.prototype,"destroyedSprite",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=i(z.prototype,"removeDelay",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),Y=i(z.prototype,"paintPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(z.prototype,"paintSprayInterval",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),J=i(z.prototype,"normalBulletPrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=i(z.prototype,"rocketPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=i(z.prototype,"fireRate",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Q=i(z.prototype,"weaponType",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return R.NORMAL}}),Z=i(z.prototype,"maxAmmo",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),X=i(z.prototype,"ammoReloadTime",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),M=z))||M));r._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerInfoUI.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerManager.ts"],(function(e){var a,n,t,r,l,i,o,s,u;return{setters:[function(e){a=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){l=e.cclegacy,i=e._decorator,o=e.Label,s=e.Component},function(e){u=e.PlayerManager}],execute:function(){var c,p,y,h,f,b,g;l._RF.push({},"66fbclPUjBL7oYA2xIdTwf+","PlayerInfoUI",void 0);var d=i.ccclass,L=i.property;e("PlayerInfoUI",(c=d("PlayerInfoUI"),p=L(o),y=L(o),c((b=a((f=function(e){function a(){for(var a,n=arguments.length,l=new Array(n),i=0;i<n;i++)l[i]=arguments[i];return a=e.call.apply(e,[this].concat(l))||this,t(a,"levelLabel",b,r(a)),t(a,"moneyLabel",g,r(a)),a._playerManager=null,a}n(a,e);var l=a.prototype;return l.onLoad=function(){this._playerManager=u.instance,this._playerManager.addDataChangeListener(this.updateUI.bind(this)),this.updateUI(this._playerManager.playerData)},l.onDestroy=function(){this._playerManager&&this._playerManager.removeDataChangeListener(this.updateUI.bind(this))},l.updateUI=function(e){this.levelLabel&&(this.levelLabel.string="level: "+e.level),this.moneyLabel&&(this.moneyLabel.string="money: "+e.money)},a}(s)).prototype,"levelLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=a(f.prototype,"moneyLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=f))||h));l._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,a,r,n,s,i,o,l,c,u;return{setters:[function(e){t=e.inheritsLoose,a=e.extends,r=e.createClass,n=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){i=e.cclegacy,o=e._decorator,l=e.director,c=e.Component,u=e.sys}],execute:function(){var h,p;i._RF.push({},"1b6d6aHKXNGGK9721LvZ7jB","PlayerManager",void 0);var _=o.ccclass,y=(o.property,e("LevelGrade",function(e){return e.S="S",e.A="A",e.B="B",e.C="C",e.D="D",e.F="F",e}({})));e("PlayerManager",_("PlayerManager")(((p=function(e){function i(){for(var t,a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this).STORAGE_KEY="TopRacing_PlayerData",t.STORAGE_KEY_BACKUP="TopRacing_PlayerData_Backup",t._playerData=null,t._wechatAPI=null,t._isWeChatMiniGame=!1,t._userId="",t._autoSaveInterval=3e4,t._lastAutoSaveTime=0,t._dataChangeCallbacks=[],t}t(i,e);var o=i.prototype;return o.onLoad=function(){i._instance?this.node.destroy():(i._instance=this,l.addPersistRootNode(this.node),this._detectEnvironment(),this.resetPlayerData(),this._initPlayerData(),this.loadPlayerData())},o.onDestroy=function(){i._instance===this&&(i._instance=null)},o.update=function(e){var t=Date.now();t-this._lastAutoSaveTime>this._autoSaveInterval&&(this._lastAutoSaveTime=t)},o._detectEnvironment=function(){"undefined"!=typeof wx&&wx.setStorageSync?(this._isWeChatMiniGame=!0,this._wechatAPI=wx,console.log("检测到微信小游戏环境")):(this._isWeChatMiniGame=!1,console.log("检测到普通游戏环境"))},o._initPlayerData=function(){this._playerData={level:1,money:1e4,experience:0,unlockedCars:[],currentCar:"car-1",carUpgrades:{"car-1":{engine:0,tires:0,suspension:0,nitro:0}},unlockedLevels:["level-1","level-2","level-3"],currentLevel:"level-1",levelProgress:{"level-1":{stars:0,completed:!1,bestTime:0,grade:y.F,attempts:0}},settings:{soundVolume:.8,musicVolume:.6},statistics:{totalRaces:0,totalWins:0,totalMoneyEarned:0},lastSaveTime:Date.now(),createTime:Date.now()}},o.loadPlayerData=function(){var e=n(s().mark((function e(){var t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{if(t=null,this._isWeChatMiniGame&&this._wechatAPI)try{t=this._wechatAPI.getStorageSync(this.STORAGE_KEY)}catch(e){console.warn("微信存储读取失败，尝试读取备份:",e),t=this._wechatAPI.getStorageSync(this.STORAGE_KEY_BACKUP)}else(a=u.localStorage.getItem(this.STORAGE_KEY))&&(t=JSON.parse(a));t?(this._playerData=this._mergePlayerData(this._playerData,t),console.log("玩家数据加载成功")):console.log("未找到存档数据，使用默认数据"),this._notifyDataChange()}catch(e){console.error("加载玩家数据失败:",e)}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),o.savePlayerData=function(){var e=n(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this._playerData.lastSaveTime=Date.now(),!this._isWeChatMiniGame||!this._wechatAPI){e.next=15;break}e.prev=3,this._wechatAPI.setStorageSync(this.STORAGE_KEY,this._playerData),this._wechatAPI.setStorageSync(this.STORAGE_KEY_BACKUP,this._playerData),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(3),console.error("微信存储保存失败:",e.t0),e.next=13,this._saveToWeChatCloud();case 13:e.next=16;break;case 15:u.localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this._playerData));case 16:console.log("玩家数据保存成功"),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(0),console.error("保存玩家数据失败:",e.t1);case 22:case"end":return e.stop()}}),e,this,[[0,19],[3,8]])})));return function(){return e.apply(this,arguments)}}(),o._mergePlayerData=function(e,t){var r=a({},e);for(var n in t)t.hasOwnProperty(n)&&("object"!=typeof t[n]||null===t[n]||Array.isArray(t[n])?r[n]=t[n]:r[n]=a({},r[n],t[n]));return r},o._saveToWeChatCloud=function(){var e=n(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._wechatAPI&&this._userId){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._wechatAPI.cloudCallFunction("savePlayerData",{userId:this._userId,data:this._playerData});case 5:console.log("数据已保存到微信云存储"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("微信云存储保存失败:",e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),o.wechatLogin=function(){var e=n(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isWeChatMiniGame&&this._wechatAPI){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.next=5,this._wechatAPI.login();case 5:if(t=e.sent,this._userId=t.code||"",!this._userId){e.next=12;break}return console.log("微信登录成功"),e.next=11,this._loadFromWeChatCloud();case 11:return e.abrupt("return",!0);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error("微信登录失败:",e.t0);case 17:return e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,this,[[2,14]])})));return function(){return e.apply(this,arguments)}}(),o._loadFromWeChatCloud=function(){var e=n(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._wechatAPI&&this._userId){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._wechatAPI.cloudCallFunction("loadPlayerData",{userId:this._userId});case 5:(t=e.sent).data&&(this._playerData=this._mergePlayerData(this._playerData,t.data),this._notifyDataChange(),console.log("从微信云端加载数据成功")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("从微信云端加载数据失败:",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),o.addDataChangeListener=function(e){this._dataChangeCallbacks.push(e)},o.removeDataChangeListener=function(e){var t=this._dataChangeCallbacks.indexOf(e);-1!==t&&this._dataChangeCallbacks.splice(t,1)},o._notifyDataChange=function(){var e=this;this._dataChangeCallbacks.forEach((function(t){try{t(e._playerData)}catch(e){console.error("数据变化回调执行失败:",e)}}))},o.addMoney=function(e){this._playerData.money+=e,this._playerData.statistics.totalMoneyEarned+=e,this._notifyDataChange()},o.spendMoney=function(e){return this._playerData.money>=e&&(this._playerData.money-=e,this._notifyDataChange(),!0)},o.addExperience=function(e){this._playerData.experience+=e;var t=100*this._playerData.level;this._playerData.experience>=t&&(this._playerData.level++,this._playerData.experience-=t,console.log("玩家升级到 "+this._playerData.level+" 级！")),this._notifyDataChange()},o.unlockCar=function(e){return-1===this._playerData.unlockedCars.indexOf(e)&&(this._playerData.unlockedCars.push(e),this._playerData.carUpgrades[e]={engine:0,tires:0,suspension:0,nitro:0},this._notifyDataChange(),!0)},o.isCarUnlocked=function(e){return-1!==this._playerData.unlockedCars.indexOf(e)},o.setCurrentCar=function(e){return-1!==this._playerData.unlockedCars.indexOf(e)&&(this._playerData.currentCar=e,this._notifyDataChange(),!0)},o.upgradeCarPart=function(e,t){if(!this._playerData.carUpgrades[e])return!1;var a=this._playerData.carUpgrades[e];return a[t]<5&&(a[t]++,this._notifyDataChange(),!0)},o.unlockLevel=function(e){return-1===this._playerData.unlockedLevels.indexOf(e)&&(this._playerData.unlockedLevels.push(e),this._playerData.levelProgress[e]={stars:0,completed:!1,bestTime:0,grade:y.F,attempts:0},this._notifyDataChange(),!0)},o.updateLevelProgress=function(e,t,a){var r=this.calculateLevelGrade(t,a);if(this._playerData.levelProgress[e]){var n=this._playerData.levelProgress[e];(a>n.stars||a===n.stars&&t<n.bestTime)&&(n.stars=a,n.bestTime=t,n.grade=r),n.completed=!0,n.attempts++}else this._playerData.levelProgress[e]={stars:a,completed:!0,bestTime:t,grade:r,attempts:1};this.checkAndUnlockNextLevel(e),this._notifyDataChange()},o.calculateLevelGrade=function(e,t){return 3===t?e<=3e4?y.S:e<=45e3?y.A:y.B:2===t?e<=6e4?y.C:y.D:1===t?y.D:y.F},o.checkAndUnlockNextLevel=function(e){var t=this._playerData.levelProgress[e];if(t&&this.isGradePassable(t.grade)){var a=this.getNextLevelId(e);a&&-1===this._playerData.unlockedLevels.indexOf(a)&&(this.unlockLevel(a),console.log("解锁新关卡: "+a))}},o.isGradePassable=function(e){return e!==y.F},o.getNextLevelId=function(e){var t=e.match(/level-(\d+)/);return t?"level-"+(parseInt(t[1])+1):null},o.getLevelProgress=function(e){return this._playerData.levelProgress[e]||null},o.isLevelUnlocked=function(e){return-1!==this._playerData.unlockedLevels.indexOf(e)},o.getLevelGradeText=function(e){var t=this.getLevelProgress(e);return t&&t.completed?t.grade:""},o.getLevelGradeColor=function(e){switch(e){case y.S:return"#FFD700";case y.A:return"#C0C0C0";case y.B:return"#CD7F32";case y.C:return"#90EE90";case y.D:return"#87CEEB";case y.F:return"#FF6B6B";default:return"#FFFFFF"}},o.updateSettings=function(e){this._playerData.settings=a({},this._playerData.settings,e),this._notifyDataChange()},o.updateStatistics=function(e){this._playerData.statistics=a({},this._playerData.statistics,e),this._notifyDataChange()},o.resetPlayerData=function(){this._initPlayerData(),this.savePlayerData(),this._notifyDataChange(),console.log("玩家数据已重置")},o.exportPlayerData=function(){return JSON.stringify(this._playerData,null,2)},o.importPlayerData=function(e){try{var t=JSON.parse(e);return this._playerData=this._mergePlayerData(this._playerData,t),this.savePlayerData(),this._notifyDataChange(),console.log("玩家数据导入成功"),!0}catch(e){return console.error("玩家数据导入失败:",e),!1}},r(i,[{key:"playerData",get:function(){return this._playerData}},{key:"isWeChatMiniGame",get:function(){return this._isWeChatMiniGame}},{key:"userId",get:function(){return this._userId}}],[{key:"instance",get:function(){return i._instance}}]),i}(c))._instance=null,h=p))||h);i._RF.pop()}}}));

System.register("chunks:///_virtual/PurchasePanel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,i,o,r,l,c,a,u;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,c=t.Label,a=t.Button,u=t.Component}],execute:function(){var s,h,p,f,b,C,y,m,d,B,L;r._RF.push({},"c4e94PebKNGoJIxF8tD6ORW","PurchasePanel",void 0);var P=l.ccclass,v=l.property;t("PurchasePanel",(s=P("PurchasePanel"),h=v({type:c,tooltip:"价格显示文本"}),p=v({type:c,tooltip:"车辆介绍文本"}),f=v({type:a,tooltip:"关闭按钮"}),b=v({type:a,tooltip:"购买确认按钮"}),s((m=n((y=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),l=0;l<e;l++)r[l]=arguments[l];return n=t.call.apply(t,[this].concat(r))||this,i(n,"priceLabel",m,o(n)),i(n,"infoLabel",d,o(n)),i(n,"closeButton",B,o(n)),i(n,"confirmButton",L,o(n)),n.currentPrice=0,n.onConfirmCallback=null,n}e(n,t);var r=n.prototype;return r.onLoad=function(){this.closeButton&&this.closeButton.node.on(a.EventType.CLICK,this.onCloseButtonClick,this),this.confirmButton&&this.confirmButton.node.on(a.EventType.CLICK,this.onConfirmButtonClick,this)},r.show=function(t,n,e){this.currentPrice=t,this.onConfirmCallback=e,this.priceLabel&&(this.priceLabel.string="$"+t),this.infoLabel&&(this.infoLabel.string=""+n),this.node&&(this.node.active=!0)},r.hide=function(){this.node&&(this.node.active=!1),this.onConfirmCallback=null},r.onCloseButtonClick=function(){this.hide()},r.onConfirmButtonClick=function(){this.onConfirmCallback&&this.onConfirmCallback(this.currentPrice),this.hide()},n}(u)).prototype,"priceLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=n(y.prototype,"infoLabel",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(y.prototype,"closeButton",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=n(y.prototype,"confirmButton",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=y))||C));r._RF.pop()}}}));

System.register("chunks:///_virtual/SceneTransition.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var n,t,o,e,s,a,c,r;return{setters:[function(i){n=i.inheritsLoose},function(i){t=i.cclegacy,o=i._decorator,e=i.director,s=i.UIOpacity,a=i.Widget,c=i.tween,r=i.Component}],execute:function(){var l,u;t._RF.push({},"c1614ZteNpJT5/yalua4TMB","SceneTransition",void 0);var d=o.ccclass;i("SceneTransition",d("SceneTransition")(((u=function(i){function t(){for(var n,t=arguments.length,o=new Array(t),e=0;e<t;e++)o[e]=arguments[e];return(n=i.call.apply(i,[this].concat(o))||this).uiOpacity=null,n.isTransitioning=!1,n}n(t,i),t.getInstance=function(){return t.instance},t.loadScene=function(i,n,o){void 0===n&&(n=.5),void 0===o&&(o=.5);var s=t.getInstance();s&&!s.isTransitioning?s.loadSceneWithTransition(i,n,o):(console.warn("SceneTransition not available, loading scene directly"),e.loadScene(i))};var o=t.prototype;return o.onLoad=function(){t.instance?this.node.destroy():(t.instance=this,e.addPersistRootNode(this.node),this.uiOpacity=this.getComponent(s),this.uiOpacity||(this.uiOpacity=this.node.addComponent(s)),this.setupFullScreenOverlay(),this.fadeIn(),console.log("SceneTransition initialized"))},o.setupFullScreenOverlay=function(){var i=this.node.getComponent(a)||this.node.addComponent(a);i.isAlignTop=!0,i.isAlignBottom=!0,i.isAlignLeft=!0,i.isAlignRight=!0,i.top=0,i.bottom=0,i.left=0,i.right=0,i.alignMode=a.AlignMode.ON_WINDOW_RESIZE,i.updateAlignment(),this.node.setSiblingIndex(999999)},o.fadeIn=function(i){var n=this;void 0===i&&(i=.5),this.uiOpacity&&!this.isTransitioning&&(this.isTransitioning=!0,this.uiOpacity.opacity=255,c(this.uiOpacity).to(i,{opacity:0}).call((function(){n.isTransitioning=!1})).start())},o.fadeOut=function(i,n){void 0===n&&(n=.5),this.uiOpacity&&!this.isTransitioning?(this.isTransitioning=!0,this.uiOpacity.opacity=0,c(this.uiOpacity).to(n,{opacity:255}).call((function(){i&&i()})).start()):i&&i()},o.loadSceneWithTransition=function(i,n,t){void 0===n&&(n=.5),this.isTransitioning?console.warn("Scene transition already in progress"):(console.log("Starting scene transition to: "+i),this.fadeOut((function(){e.loadScene(i,(function(){console.log("Scene transition to "+i+" completed")}))}),n))},o.onDestroy=function(){t.instance===this&&(t.instance=null)},t}(r)).instance=null,l=u))||l);t._RF.pop()}}}));

System.register("chunks:///_virtual/SelectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TempData.ts","./PlayerManager.ts","./SceneTransition.ts","./CarPropertyDisplay.ts","./PurchasePanel.ts"],(function(e){var n,t,r,a,i,o,s,c,l,u,p,h,f,g,d,y,C,v,P,m;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){i=e.cclegacy,o=e._decorator,s=e.ToggleContainer,c=e.Button,l=e.Label,u=e.Node,p=e.Sprite,h=e.Color,f=e.find,g=e.Toggle,d=e.Component},function(e){y=e.TempData},function(e){C=e.PlayerManager},function(e){v=e.SceneTransition},function(e){P=e.CarPropertyDisplay},function(e){m=e.PurchasePanel}],execute:function(){var b,T,w,L,I,B,D,M,k,G,S,E,N,x,z,A,K;i._RF.push({},"be7b23A2jVN6agcMGkP3NKP","SelectManager",void 0);var q=o.ccclass,F=o.property;e("SelectManager",(b=q("SelectManager"),T=F(s),w=F(s),L=F(c),I=F(c),B=F(l),D=F({type:u,tooltip:"场景中的购买面板节点"}),M=F({type:P,tooltip:"car-property节点上的CarPropertyDisplay组件"}),b((S=n((G=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return n=e.call.apply(e,[this].concat(i))||this,r(n,"levelToggleGroup",S,a(n)),r(n,"carToggleGroup",E,a(n)),r(n,"startButton",N,a(n)),r(n,"backButton",x,a(n)),r(n,"insufficientMoneyLabel",z,a(n)),r(n,"purchasePanelNode",A,a(n)),r(n,"carPropertyDisplay",K,a(n)),n.carPrices={"car-1":0,"car-2":500,"car-3":1e3,"car-4":1500,"car-5":2e3},n.carInfos={"car-1":"操控性超强小车，武器配备为子弹发射器，击中对手你可造成伤害 \n This super maneuverable car is equipped with a bullet launcher. When you hit your opponent, you can cause damage.","car-2":"经典跑车,具有坚固的车身,武器配备为火箭炮，爆炸后会清除附近的颜料 \nClassic sports car, with a sturdy body, equipped with  a rocket launcher. After explosion, it will clear the nearby paint.","car-3":"现代化的超级跑车，速度与转向均衡，配备武器为机炮，击中后可造成伤害 \nA modern supercar with balanced speed and steering, equipped with a bullet launcher. When you hit your opponent, you can cause damage.","car-4":"甩尾加速犹如闪电，武器配备为火箭炮，爆炸后会清除附近的颜料\nThe drift and acceleration is like lightning, equipped with a rocket launcher. After explosion, it will clear the nearby paint.","car-5":"送豆腐专用，即使在狭窄的山路也灵活穿梭，武器配备为火箭炮，爆炸后会清除附近的颜料\n It is specially designed for delivering tofu and can move flexibly even on narrow mountain roads. equipped with a rocket launcher. "},n.insufficientMoneyTimer=0,n.pendingCarId=null,n}t(n,e);var i=n.prototype;return i.onLoad=function(){this.updateLevelToggles(),this.updateCarToggles(),this.setupCarPurchaseButtons(),this.setupCarSelectionListener(),this.insufficientMoneyLabel&&(this.insufficientMoneyLabel.node.active=!1),this.autoFindCarPropertyDisplay()},i.updateLevelToggles=function(){var e=this,n=C.instance;console.log("更新关卡显示"),this.levelToggleGroup.toggleItems.forEach((function(t){var r=t.node.name,a=n.isLevelUnlocked(r);console.log("关卡 "+r+": 解锁状态 = "+a),t.interactable=a;var i=t.node.getComponent(p),o=t.node.getChildByName("lock");i&&(i.color=a?h.WHITE:h.BLACK),o&&(o.active=!a),e.updateLevelGradeDisplay(t.node,r)}))},i.updateLevelGradeDisplay=function(e,n){var t,r=C.instance,a=r.getLevelGradeText(n),i=e.getChildByName("GradeLabel");i||(i=null==(t=e.getComponentInChildren(l))?void 0:t.node);if(i){var o=i.getComponent(l);if(o)if(a){o.string=a,o.node.active=!0;var s=r.getLevelProgress(n);if(s){var c=r.getLevelGradeColor(s.grade);o.color=this.hexToColor(c)}}else o.string="",o.node.active=!1}},i.hexToColor=function(e){var n=parseInt(e.slice(1,3),16),t=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16);return new h(n,t,r,255)},i.updateCarToggles=function(){var e=this,n=C.instance.playerData.unlockedCars;this.carToggleGroup.toggleItems.forEach((function(t){var r=t.node.name,a=-1!==n.indexOf(r);t.interactable=a;var i=t.node.getComponent(p);i&&(i.color=a?h.WHITE:h.BLACK),e.updateCarPurchaseButton(t.node,r,a)}))},i.start=function(){this.startButton&&this.startButton.node.on(c.EventType.CLICK,this.onStartGame,this),this.backButton&&this.backButton.node.on(c.EventType.CLICK,this.onBackButton,this)},i.onStartGame=function(){var e=this.levelToggleGroup.toggleItems.find((function(e){return e.isChecked})),n=this.carToggleGroup.toggleItems.find((function(e){return e.isChecked}));e&&n&&(y.selectedLevel=e.node.name,y.selectedCar=n.node.name,console.log(e.node.name,n.node.name),v.loadScene("gamescene"))},i.onBackButton=function(){v.loadScene("mainmenu")},i.setupCarPurchaseButtons=function(){var e=this;this.carToggleGroup.toggleItems.forEach((function(n){var t=n.node.name,r=-1!==C.instance.playerData.unlockedCars.indexOf(t);e.updateCarPurchaseButton(n.node,t,r)}))},i.updateCarPurchaseButton=function(e,n,t){var r=this,a=e.getChildByName("PurchaseButton");if(t||void 0===this.carPrices[n])a&&(a.active=!1);else if(a||(a=e.getChildByName("PurchaseButton")),a){a.active=!0;var i=a.getComponent(c);i&&(i.node.off(c.EventType.CLICK),i.node.on(c.EventType.CLICK,(function(){r.pendingCarId=n,r.showPurchasePanel(r.carPrices[n],r.carInfos[n])}),this))}},i.showPurchasePanel=function(e,n){var t=this;if(this.purchasePanelNode){var r=this.purchasePanelNode.getComponent(m);r?r.show(e,n,(function(e){t.processPurchase(e)})):console.error("购买面板组件未找到")}else console.error("购买面板节点未配置")},i.processPurchase=function(e){if(this.pendingCarId){var n=this.pendingCarId,t=C.instance;t.playerData.money>=e?t.spendMoney(e)&&(t.unlockCar(n),console.log("成功购买车辆 "+n+"，花费 "+e+" 金币"),this.updateCarToggles(),t.savePlayerData()):this.showInsufficientMoneyMessage(),this.pendingCarId=null}},i.showInsufficientMoneyMessage=function(){this.insufficientMoneyLabel&&(this.insufficientMoneyLabel.string="金币不足！",this.insufficientMoneyLabel.node.active=!0,this.insufficientMoneyTimer=3)},i.update=function(e){this.insufficientMoneyTimer>0&&(this.insufficientMoneyTimer-=e,this.insufficientMoneyTimer<=0&&this.insufficientMoneyLabel&&(this.insufficientMoneyLabel.node.active=!1))},i.getCarPrice=function(e){return this.carPrices[e]||0},i.setCarPrice=function(e,n){this.carPrices[e]=n},i.autoFindCarPropertyDisplay=function(){if(!this.carPropertyDisplay){var e=f("Canvas/car-property")||f("car-property")||this.node.getChildByName("car-property");e?(this.carPropertyDisplay=e.getComponent(P),this.carPropertyDisplay||console.warn("car-property节点找到了，但没有CarPropertyDisplay组件")):console.warn("未找到car-property节点，请确保场景中存在该节点")}},i.setupCarSelectionListener=function(){var e=this;this.carToggleGroup?(this.carToggleGroup.toggleItems.forEach((function(n){n.node.on(g.EventType.TOGGLE,e.onCarToggleChanged,e)})),this.checkInitialCarSelection()):console.warn("carToggleGroup未设置")},i.onCarToggleChanged=function(e){if(e.isChecked){var n=e.node.name;console.log("选中车辆: "+n),this.showCarProperties(n)}},i.showCarProperties=function(e){this.carPropertyDisplay?this.carPropertyDisplay.showCarProperties(e):console.warn("CarPropertyDisplay组件未找到，无法显示车辆属性")},i.checkInitialCarSelection=function(){var e=this.carToggleGroup.toggleItems.find((function(e){return e.isChecked}));if(e){var n=e.node.name;this.showCarProperties(n)}else this.carPropertyDisplay&&this.carPropertyDisplay.hideAllProperties()},n}(d)).prototype,"levelToggleGroup",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(G.prototype,"carToggleGroup",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(G.prototype,"startButton",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(G.prototype,"backButton",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=n(G.prototype,"insufficientMoneyLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(G.prototype,"purchasePanelNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=n(G.prototype,"carPropertyDisplay",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=G))||k));i._RF.pop()}}}));

System.register("chunks:///_virtual/SoundManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,r,u,c,a,n,l,s,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.createClass,r=t.initializerDefineProperty,u=t.assertThisInitialized},function(t){c=t.cclegacy,a=t._decorator,n=t.AudioSource,l=t.director,s=t.sys,d=t.Component}],execute:function(){var S,p,h,A,f,b,g,y,m,v,D,k,C,w,z,M,_,B;c._RF.push({},"7c3850Yg29IBK4wW9FYz7f1","SoundManager",void 0);var I=a.ccclass,E=a.property;t("SoundManager",(S=I("SoundManager"),p=E({type:n,tooltip:"背景音乐"}),h=E({type:n,tooltip:"按钮点击音效"}),A=E({type:n,tooltip:"车辆碰撞音效"}),f=E({type:n,tooltip:"车辆毁坏音效"}),b=E({type:n,tooltip:"车辆启动音效"}),g=E({type:n,tooltip:"车辆加速音效"}),y=E({type:n,tooltip:"车辆漂移音效"}),S(((B=function(t){function e(){for(var e,o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];return e=t.call.apply(t,[this].concat(i))||this,r(e,"bgmAudioSource",D,u(e)),r(e,"buttonClickAudioSource",k,u(e)),r(e,"carCollisionAudioSource",C,u(e)),r(e,"carDestructionAudioSource",w,u(e)),r(e,"carStartAudioSource",z,u(e)),r(e,"carAccelerateAudioSource",M,u(e)),r(e,"carDriftAudioSource",_,u(e)),e.allAudioSources=[],e}o(e,t);var c=e.prototype;return c.onLoad=function(){e._instance?this.destroy():(e._instance=this,l.addPersistRootNode(this.node),this.allAudioSources.push(this.bgmAudioSource),this.allAudioSources.push(this.buttonClickAudioSource),this.allAudioSources.push(this.carCollisionAudioSource),this.allAudioSources.push(this.carDestructionAudioSource),this.allAudioSources.push(this.carStartAudioSource),this.allAudioSources.push(this.carAccelerateAudioSource),this.allAudioSources.push(this.carDriftAudioSource),this.loadState())},c.start=function(){this.playBGM()},c.playBGM=function(){this.bgmAudioSource&&this.bgmAudioSource.play()},c.playSoundEffect=function(t){var e=null;switch(t){case"buttonClick":e=this.buttonClickAudioSource;break;case"carCollision":e=this.carCollisionAudioSource;break;case"carDestruction":e=this.carDestructionAudioSource;break;case"carStart":e=this.carStartAudioSource;break;case"carAccelerate":e=this.carAccelerateAudioSource;break;case"carDrift":e=this.carDriftAudioSource}e&&e.play()},c.toggleAudio=function(){var t=this,e=this.isMuted()?1:0;this.allAudioSources.forEach((function(o){o===t.bgmAudioSource?o.volume=.3*e:o&&(o.volume=e)})),this.saveState()},c.isMuted=function(){return!!this.bgmAudioSource&&0===this.bgmAudioSource.volume},c.saveState=function(){var t={muted:this.isMuted()};s.localStorage.setItem("soundState",JSON.stringify(t))},c.loadState=function(){var t=this,e=s.localStorage.getItem("soundState");if(e){var o=JSON.parse(e).muted?0:1;this.allAudioSources.forEach((function(e){e===t.bgmAudioSource?e.volume=.3*o:e&&(e.volume=o)}))}},i(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(d))._instance=null,D=e((v=B).prototype,"bgmAudioSource",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(v.prototype,"buttonClickAudioSource",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(v.prototype,"carCollisionAudioSource",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(v.prototype,"carDestructionAudioSource",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(v.prototype,"carStartAudioSource",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(v.prototype,"carAccelerateAudioSource",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(v.prototype,"carDriftAudioSource",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=v))||m));c._RF.pop()}}}));

System.register("chunks:///_virtual/TempData.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"4702aLSiftLiKCAlxKVKQG+","TempData",void 0);var c=e("TempData",(function(){}));c.selectedLevel="",c.selectedCar="",t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});