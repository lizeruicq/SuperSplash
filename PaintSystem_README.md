# 颜料系统使用说明

## 概述

颜料系统为赛车游戏添加了车辆行进时持续喷洒颜料的功能。每辆车都会在行进过程中定期在地图上留下颜料痕迹，新的颜料会覆盖旧的颜料。

## 系统架构

### 设计原则
- **低耦合**: 所有颜料操作都通过GameManager作为中介，避免组件间直接依赖
- **单一职责**: 每个组件只负责自己的核心功能
- **统一管理**: GameManager统一协调所有颜料相关的操作

### 系统组件

#### 1. GameManager（游戏管理器 - 中介者）
- **功能**: 作为颜料系统的中介，协调所有颜料操作
- **主要方法**:
  - `sprayPaint()`: 车辆喷洒颜料的统一入口
  - `clearAllPaint()`: 清除所有颜料
  - `getVehiclePaintCount()`: 获取指定车辆的颜料数量
  - `getTotalPaintCount()`: 获取总颜料数量

#### 2. PaintManager（颜料管理器 - 内部实现）
- **功能**: 管理游戏中所有颜料的生成、覆盖和销毁
- **位置**: 由GameManager内部创建和管理，外部不直接访问
- **特点**: 作为内部实现，不被其他组件直接调用

#### 3. PaintSpot（颜料斑点组件）
- **功能**: 单个颜料斑点的行为控制
- **特性**: 支持颜色设置、淡化效果、生成动画

#### 4. Player/AIPlayer 颜料喷洒功能
- **新增属性**:
  - `paintPrefab`: 颜料预制体（需要在编辑器中拖拽设置）
  - `paintSprayInterval`: 颜料喷洒间隔（默认0.2秒）
- **调用方式**: 通过GameManager.sprayPaint()进行颜料喷洒

## 设置步骤

### 1. 创建颜料预制体

1. 在场景中创建一个新的空节点，命名为"Paint"
2. 添加Sprite组件，设置颜料的图片
3. 添加PaintSpot脚本组件
4. 设置节点大小（建议与车辆大小相当）
5. 将节点保存为预制体到 `assets/resources/prefab/paints/` 目录

### 2. 配置车辆颜料

#### 玩家车辆配置：
1. 选择玩家车辆预制体
2. 在Player组件中找到"Paint Prefab"属性
3. 将创建的颜料预制体拖拽到该属性
4. 调整"Paint Spray Interval"（喷洒间隔）

#### AI车辆配置：
1. 选择AI车辆预制体
2. 在AIPlayer组件中找到"Paint Prefab"属性
3. 将创建的颜料预制体拖拽到该属性
4. 调整"Paint Spray Interval"（喷洒间隔）

### 3. 不同车辆使用不同颜料

为了区分不同车辆的颜料，建议：
1. 为每种车辆创建不同颜色的颜料预制体
2. 在PaintSpot组件中设置不同的颜色
3. 或者使用不同的颜料图片

## 颜料覆盖机制

- **覆盖范围**: 由PaintManager的`coverageRadius`属性控制（默认30像素）
- **覆盖规则**: 当新颜料与现有颜料距离小于覆盖半径时，旧颜料会被移除
- **同车辆颜料**: 同一车辆的颜料不会相互覆盖

## 架构优势

### 1. 低耦合设计
- Player和AIPlayer不直接依赖PaintManager
- 所有颜料操作都通过GameManager统一协调
- 便于系统维护和扩展

### 2. 统一管理
- 颜料相关的所有操作都有统一的入口
- 便于添加全局颜料控制逻辑（如暂停、清除等）
- 便于调试和监控

### 3. 易于扩展
- 新增颜料功能只需在GameManager中添加中介方法
- 不影响现有的Player和AIPlayer逻辑
- 支持未来添加更复杂的颜料交互

## 性能优化建议

1. **颜料数量限制**: 系统会自动通过覆盖机制控制颜料数量
2. **淡化效果**: 可在PaintSpot中启用`enableFade`来让颜料自动消失
3. **喷洒频率**: 适当调整`paintSprayInterval`以平衡视觉效果和性能

## 调试信息

系统会在控制台输出以下调试信息：
- 颜料添加信息（通过GameManager）
- 颜料覆盖信息
- PaintManager初始化状态

## 示例配置

```typescript
// 在Player或AIPlayer组件中
paintSprayInterval: 0.2  // 每0.2秒喷洒一次颜料
```

## 注意事项

1. 确保每个车辆都配置了颜料预制体，否则不会喷洒颜料
2. 颜料预制体必须包含PaintSpot组件
3. **重要**: 颜料节点的层级会被自动设置为`UI_2D`，确保颜料固定在游戏世界坐标中
4. 游戏重新开始时，所有颜料会被自动清除
5. 车辆被摧毁后会停止喷洒颜料

## 扩展功能

系统设计支持以下扩展：
- 不同类型的颜料效果
- 颜料的特殊属性（如加速、减速区域）
- 颜料的持续时间控制
- 更复杂的覆盖规则
